{{template "admin-base" .}}

{{define "additional-css"}}
<link rel="stylesheet" href="/static/css/dashboard-interactions.css">
{{end}}

{{define "head"}}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{{end}}

{{define "layout-data"}}x-data="propertyListData()" x-init="init()" @keydown.escape="closeBulkModal()"{{end}}

{{define "content"}}
<div class="tab-nav">
    <button class="tab-button" :class="{ 'active': activeTab === 'all' }" @click="switchTab('all')">
        All Properties
        <span class="tab-count" x-show="sidebarCounts.active_properties" x-text="sidebarCounts.active_properties"></span>
    </button>
    <button class="tab-button" :class="{ 'active': activeTab === 'performance' }" @click="switchTab('performance')">
        Performance
    </button>
    <button class="tab-button" :class="{ 'active': activeTab === 'calendar' }" @click="switchTab('calendar')">
        Calendar
    </button>
    <button class="tab-button" :class="{ 'active': activeTab === 'prelisting' }" @click="switchTab('prelisting')">
        Pre-Listing
    </button>
    <button class="tab-button" :class="{ 'active': activeTab === 'valuations' }" @click="switchTab('valuations')">
        Valuations
    </button>
</div>

<div class="tab-content" :class="{ 'active': activeTab === 'all' }">
    <div class="bulk-actions-bar" x-show="selectedProperties.length > 0" x-transition style="display: none;">
        <span class="selected-count" x-text="selectedProperties.length + ' selected'"></span>
        <div class="bulk-actions">
            <button class="btn btn-sm" @click="showBulkStatusModal()">Update Status</button>
            <button class="btn btn-sm" @click="showBulkAssignModal()">Assign to Agent</button>
            <button class="btn btn-sm" @click="showBulkFeaturedModal()">Toggle Featured</button>
            <button class="btn btn-sm" @click="bulkExport()">Export CSV</button>
        </div>
        <button class="btn btn-text" @click="clearSelection()">Clear Selection</button>
    </div>

    <div class="filters-bar">
        <div class="flex align-center gap-2">
            <input type="checkbox" class="select-all-checkbox" 
                   :checked="allPropertiesSelected" 
                   @change="toggleAllProperties()"
                   :indeterminate.prop="selectedProperties.length > 0 && !allPropertiesSelected">
            <label class="text-sm text-gray-600">Select All</label>
        </div>
        <input type="search" class="search-input" placeholder="Search by address, city, or zip code..." x-model="searchQuery" @input.debounce.300ms="performSearch">
        
        <select class="filter-select" x-model="statusFilter" @change="applyFilters()">
            <option value="all">All Status</option>
            <option value="active">Active</option>
            <option value="pending">Pending</option>
            <option value="inactive">Inactive</option>
        </select>
        
        <select class="filter-select" x-model="typeFilter" @change="applyFilters()">
            <option value="all">All Types</option>
            <option value="sale">For Sale</option>
            <option value="rent">For Rent</option>
        </select>
        
        <div class="view-toggle">
            <button class="view-toggle-btn" :class="{ 'active': viewMode === 'table' }" @click="viewMode = 'table'">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                </svg>
                Table
            </button>
            <button class="view-toggle-btn" :class="{ 'active': viewMode === 'grid' }" @click="viewMode = 'grid'">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                </svg>
                Grid
            </button>
        </div>
        
        <a href="/admin/property-create" class="btn btn-primary">
            + Add Property
        </a>
    </div>

    <div x-show="viewMode === 'table'">
        <div x-show="loading" class="text-center p-12">
            <div class="loading-spinner mx-auto"></div>
            <p class="text-gray-500 mt-4">Loading properties...</p>
        </div>
        
        <div x-show="!loading && properties.length === 0" class="empty-state">
            <svg width="64" height="64" class="mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path>
            </svg>
            <div class="empty-state-title">No Properties Found</div>
            <div class="empty-state-message">Start by adding your first property</div>
        </div>
        
        <div x-show="!loading && properties.length > 0" class="table-wrapper">
            <p class="text-center text-gray-500">Property table and grid views managed by external JavaScript</p>
            <p class="text-sm text-gray-400 text-center">See /static/js/property-crud.js for implementation</p>
        </div>
    </div>
</div>

<div class="tab-content" :class="{ 'active': activeTab === 'performance' }">
    <div class="section-label admin-section-label">
      <span class="section-label-line"></span>
      <span class="section-label-text">Performance Analytics</span>
      <span class="section-label-line"></span>
    </div>
    <p class="text-gray-500 mb-6">Track property views, leads generated, and engagement metrics</p>
    
    <div class="stats-grid-4">
        <div class="stat-card">
            <div class="stat-value">0</div>
            <div class="stat-label">Total Views</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">0</div>
            <div class="stat-label">Inquiries</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">0</div>
            <div class="stat-label">Showings</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">0</div>
            <div class="stat-label">Favorites</div>
        </div>
    </div>
</div>

<div class="tab-content" :class="{ 'active': activeTab === 'calendar' }">
    <div class="section-label admin-section-label">
      <span class="section-label-line"></span>
      <span class="section-label-text">Showing Calendar</span>
      <span class="section-label-line"></span>
    </div>
    <p class="text-gray-500 mb-6">Manage property showings and appointments</p>
    <a href="/admin/calendar" class="btn btn-primary">Open Full Calendar</a>
</div>

<div class="tab-content" :class="{ 'active': activeTab === 'prelisting' }">
    <div class="section-label admin-section-label">
      <span class="section-label-line"></span>
      <span class="section-label-text">Pre-Listing Pipeline</span>
      <span class="section-label-line"></span>
    </div>
    <p class="text-gray-500 mb-6">Properties in preparation before going live</p>
    <a href="/admin/pre-listing-manager" class="btn btn-primary">Manage Pre-Listings</a>
</div>

<div class="tab-content" :class="{ 'active': activeTab === 'valuations' }">
    <div class="section-label admin-section-label">
      <span class="section-label-line"></span>
      <span class="section-label-text">Property Valuations</span>
      <span class="section-label-line"></span>
    </div>
    <p class="text-gray-500 mb-6">AI-powered property valuations and market analysis</p>
    <a href="/admin/valuations" class="btn btn-primary">View Valuations</a>
</div>
{{end}}

{{define "scripts"}}
<script src="/static/js/property-crud.js"></script>
<script>
    function propertyListData() {
        return {
            loading: false,
            properties: [],
            selectedProperties: [],
            allPropertiesSelected: false,
            activeTab: 'all',
            searchQuery: '',
            statusFilter: 'all',
            typeFilter: 'all',
            viewMode: 'table',
            sidebarCounts: {
                active_properties: 0
            },
            
            init() {
                this.fetchProperties();
            },
            
            switchTab(tab) {
                this.activeTab = tab;
            },
            
            async fetchProperties() {
                this.loading = true;
                try {
                    const response = await fetch('/api/properties');
                    if (response.ok) {
                        this.properties = await response.json();
                        this.sidebarCounts.active_properties = this.properties.length;
                    }
                } catch (error) {
                    console.error('Failed to fetch properties:', error);
                } finally {
                    this.loading = false;
                }
            },
            
            performSearch() {
            },
            
            applyFilters() {
            },
            
            toggleAllProperties() {
                if (this.allPropertiesSelected) {
                    this.selectedProperties = [];
                } else {
                    this.selectedProperties = this.properties.map(p => p.id);
                }
                this.allPropertiesSelected = !this.allPropertiesSelected;
            },
            
            clearSelection() {
                this.selectedProperties = [];
                this.allPropertiesSelected = false;
            },
            
            showBulkStatusModal() {},
            showBulkAssignModal() {},
            showBulkFeaturedModal() {},
            closeBulkModal() {},
            bulkExport() {}
        };
    }
</script>
{{end}}
