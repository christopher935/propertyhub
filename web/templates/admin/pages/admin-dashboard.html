<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>Dashboard - PropertyHub</title>
    <link rel="stylesheet" href="/static/css/admin-design-tokens.css">
    <link rel="stylesheet" href="/static/css/admin-scout-utilities.css">
    <link rel="stylesheet" href="/static/css/admin-scout-layouts.css">
    <link rel="stylesheet" href="/static/css/scout-components-admin.css">
    <link rel="stylesheet" href="/static/css/dashboard-interactions.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="/static/js/ux-enhancements.js"></script>
</head>
<body>
    <div class="admin-layout" x-data="dashboardData()" x-init="init()">
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <a href="/admin/dashboard" class="sidebar-logo">
                    <div class="sidebar-logo-icon">PH</div>
                    <span>PropertyHub</span>
                </a>
            </div>
            
            <nav class="admin-sidebar-nav">
                <div class="nav-section expanded">
                    <a href="/admin/dashboard" class="nav-section-header active">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div>
                        <span class="nav-section-title">Dashboard</span>
                    </a>
                </div>
                
                <div class="nav-section" x-data="{ open: false }">
                    <button class="nav-section-header" @click="open = !open">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div>
                        <span class="nav-section-title">Leads</span>
                        <span class="nav-section-badge" x-text="sidebarCounts.total_leads || 0"></span>
                        <svg class="w-4 h-4 nav-section-toggle transition" :class="{ 'rotate-90': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                    <ul class="nav-section-items" x-show="open" x-collapse>
                        <li><a href="/admin/leads" class="nav-item">All Leads <span class="nav-item-badge" x-text="sidebarCounts.total_leads || 0"></span></a></li>
                        <li><a href="/admin/leads?segment=hot" class="nav-item">Hot Leads <span class="nav-item-badge" x-text="sidebarCounts.hot_leads || 0"></span></a></li>
                        <li><a href="/admin/leads?segment=warm" class="nav-item">Warm Leads <span class="nav-item-badge" x-text="sidebarCounts.warm_leads || 0"></span></a></li>
                        <li><a href="/admin/communication" class="nav-item">Communication Center</a></li>
                    </ul>
                </div>
                
                <div class="nav-section" x-data="{ open: false }">
                    <button class="nav-section-header" @click="open = !open">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg></div>
                        <span class="nav-section-title">Properties</span>
                        <span class="nav-section-badge" x-text="sidebarCounts.active_properties || 0"></span>
                        <svg class="w-4 h-4 nav-section-toggle transition" :class="{ 'rotate-90': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                    <ul class="nav-section-items" x-show="open" x-collapse>
                        <li><a href="/admin/properties" class="nav-item">All Properties</a></li>
                        <li><a href="/admin/properties?status=active" class="nav-item">Active Listings</a></li>
                        <li><a href="/admin/properties?status=pending_images" class="nav-item">Pending Images <span class="nav-item-badge" x-text="sidebarCounts.pending_images || 0"></span></a></li>
                        <li><a href="/admin/pre-listing" class="nav-item">Pre-Listing Pipeline</a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <a href="/admin/applications" class="nav-section-header">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div>
                        <span class="nav-section-title">Applications</span>
                        <span class="nav-section-badge" x-text="sidebarCounts.pending_applications || 0"></span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <a href="/admin/bookings" class="nav-section-header">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>
                        <span class="nav-section-title">Bookings</span>
                        <span class="nav-section-badge" x-text="sidebarCounts.confirmed_bookings || 0"></span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <a href="/admin/closing-pipeline" class="nav-section-header">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg></div>
                        <span class="nav-section-title">Closing Pipeline</span>
                        <span class="nav-section-badge" x-text="sidebarCounts.closing_pipeline || 0"></span>
                    </a>
                </div>
                
                <div class="nav-section" x-data="{ open: false }">
                    <button class="nav-section-header" @click="open = !open">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg></div>
                        <span class="nav-section-title">Intelligence</span>
                        <svg class="w-4 h-4 nav-section-toggle transition" :class="{ 'rotate-90': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                    <ul class="nav-section-items" x-show="open" x-collapse>
                        <li><a href="/admin/business-intelligence" class="nav-item">Business Intelligence</a></li>
                        <li><a href="/admin/behavioral-intelligence" class="nav-item">Behavioral Analytics</a></li>
                        <li><a href="/admin/market-intelligence" class="nav-item">Market Intelligence</a></li>
                    </ul>
                </div>
                
                <div class="nav-section" x-data="{ open: false }">
                    <button class="nav-section-header" @click="open = !open">
                        <div class="nav-section-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div>
                        <span class="nav-section-title">System</span>
                        <svg class="w-4 h-4 nav-section-toggle transition" :class="{ 'rotate-90': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                    <ul class="nav-section-items" x-show="open" x-collapse>
                        <li><a href="/admin/settings" class="nav-item">Settings</a></li>
                        <li><a href="/admin/rbac" class="nav-item">Roles & Permissions</a></li>
                        <li><a href="/admin/integrations/webhooks" class="nav-item">Integrations</a></li>
                        <li><a href="/admin/security" class="nav-item">Security Monitoring</a></li>
                    </ul>
                </div>
            </nav>
        </aside>
        
        <main class="admin-main">
            <header class="admin-header">
                <div class="admin-header-content">
                    <h1 class="admin-header-title">Dashboard</h1>
                    
                    <div class="admin-header-actions">
                        <!-- Active Visitors Counter -->
                        <div class="visitor-counter" 
                             x-data="visitorCounter()"
                             x-init="init()"
                             :class="{ 'high-traffic': count >= 6, 'no-visitors': count === 0 }">
                            <div class="counter-main" @mouseenter="showBreakdown = true" @mouseleave="showBreakdown = false">
                                <span class="counter-icon">üëÅÔ∏è</span>
                                <span class="counter-value" 
                                      x-text="count"
                                      :class="{ 'pulse': justChanged }"></span>
                                <span class="counter-label">
                                    <span x-text="count === 1 ? 'visitor' : 'visitors'"></span> browsing now
                                </span>
                                <div class="counter-trend" x-show="trend !== 0">
                                    <span x-text="trend > 0 ? '‚ñ≤' : '‚ñº'" :class="trend > 0 ? 'trend-up' : 'trend-down'"></span>
                                    <span x-text="Math.abs(trend)"></span>
                                </div>
                            </div>
                            <div class="counter-breakdown" x-show="showBreakdown && Object.keys(byPage).length > 0" x-transition>
                                <template x-for="(pageCount, page) in byPage" :key="page">
                                    <div class="breakdown-item">
                                        <span class="breakdown-count" x-text="pageCount"></span> on <span class="breakdown-page" x-text="page"></span>
                                    </div>
                                </template>
                                <div class="breakdown-meta" x-show="hotCount > 0">
                                    <span class="hot-badge">üî• <span x-text="hotCount"></span> hot leads</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-search">
                            <input type="search" placeholder="Search leads, properties..." x-model="searchQuery" @input.debounce.300ms="performSearch">
                            <svg class="admin-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        
                        <div class="admin-user-menu">
                            <div class="admin-user-avatar" x-text="userProfile.initials"></div>
                            <div class="admin-user-info">
                                <div class="admin-user-name" x-text="userProfile.username"></div>
                                <div class="admin-user-role" x-text="userProfile.role"></div>
                            </div>
                        </div>
                        
                        <a href="/admin/logout" class="btn-logout">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            Logout
                        </a>
                    </div>
                </div>
            </header>
            
            <div class="admin-content">
                <section class="dashboard-section dashboard-critical" x-show="criticalStats.pendingBookings > 0 || criticalStats.pendingApplications > 0 || criticalStats.alerts > 0">
                    <div class="critical-actions-bar">
                        <div class="critical-item" x-show="criticalStats.pendingBookings > 0">
                            <span class="critical-count" x-text="criticalStats.pendingBookings"></span>
                            <span class="critical-label">Pending Bookings</span>
                            <a href="/admin/bookings" class="critical-link">Review ‚Üí</a>
                        </div>
                        <div class="critical-item" x-show="criticalStats.pendingApplications > 0">
                            <span class="critical-count" x-text="criticalStats.pendingApplications"></span>
                            <span class="critical-label">Pending Applications</span>
                            <a href="/admin/applications" class="critical-link">Review ‚Üí</a>
                        </div>
                        <div class="critical-item" x-show="criticalStats.alerts > 0">
                            <span class="critical-count" x-text="criticalStats.alerts"></span>
                            <span class="critical-label">System Alerts</span>
                            <a href="/admin/security" class="critical-link">View ‚Üí</a>
                        </div>
                    </div>
                </section>

                <section class="dashboard-section">
                    <div class="section-label admin-section-label">
                      <span class="section-label-line"></span>
                      <span class="section-label-text">Key Metrics</span>
                      <span class="section-label-line"></span>
                    </div>
                    <div class="stats-grid stats-grid-4">
                        <div class="stat-card" x-data="statCard('active_leads')">
                            <div class="stat-card-label">Active Leads</div>
                            <div class="stat-card-value" x-text="Math.round(displayValue)"></div>
                            <div class="stat-card-change" :class="keyMetrics.activeLeadsTrend > 0 ? 'positive' : 'negative'">
                                <span x-text="keyMetrics.activeLeadsTrend > 0 ? '‚Üë' : '‚Üì'"></span>
                                <span x-text="Math.abs(keyMetrics.activeLeadsTrend) + '%'"></span>
                            </div>
                        </div>
                        
                        <div class="stat-card" x-data="statCard('conversion_rate')">
                            <div class="stat-card-label">Conversion Rate</div>
                            <div class="stat-card-value" x-text="displayValue.toFixed(1) + '%'"></div>
                            <div class="stat-card-subtitle">30-day average</div>
                        </div>
                        
                        <div class="stat-card" x-data="statCard('revenue_mtd')">
                            <div class="stat-card-label">Revenue MTD</div>
                            <div class="stat-card-value" x-text="formatCurrency(displayValue)"></div>
                            <div class="stat-card-change" :class="keyMetrics.revenueTrend > 0 ? 'positive' : 'negative'">
                                <span x-text="keyMetrics.revenueTrend > 0 ? '‚Üë' : '‚Üì'"></span>
                                <span x-text="Math.abs(keyMetrics.revenueTrend) + '%'"></span>
                            </div>
                        </div>
                        
                        <div class="stat-card" x-data="statCard('bookings_week')">
                            <div class="stat-card-label">Bookings This Week</div>
                            <div class="stat-card-value" x-text="Math.round(displayValue)"></div>
                            <div class="stat-card-subtitle">
                                <span x-text="keyMetrics.confirmedBookings"></span> confirmed
                            </div>
                        </div>
                    </div>
                </section>

                <section class="dashboard-section">
                    <div class="dashboard-columns">
                        <div class="dashboard-column">
                            <div class="d-flex justify-between align-center mb-4">
                                <div class="section-label admin-section-label">
                                  <span class="section-label-line"></span>
                                  <span class="section-label-text">Top Opportunities</span>
                                  <span class="section-label-line"></span>
                                </div>
                                <a href="/admin/business-intelligence" class="view-all">View All ‚Üí</a>
                            </div>
                            
                            <div x-show="loadingOpportunities" class="d-flex justify-center p-6">
                                <div class="loading"></div>
                            </div>
                            
                            <div x-show="!loadingOpportunities">
                                <template x-for="(opp, index) in opportunities.slice(0, 4)" :key="opp.id">
                                    <div class="opportunity-card mb-3">
                                        <div class="opportunity-header">
                                            <div class="opportunity-rank" x-text="'#' + (index + 1)"></div>
                                            <div class="opportunity-badges">
                                                <span class="badge badge-danger text-xs" x-text="'Priority: ' + opp.priority"></span>
                                                <span class="badge badge-success text-xs" x-text="Math.round(opp.conversion_probability * 100) + '%'"></span>
                                            </div>
                                        </div>
                                        <h4 class="opportunity-title" x-text="opp.lead_name"></h4>
                                        <p class="opportunity-type" x-text="opp.type.replace(/_/g, ' ')"></p>
                                        <div class="opportunity-property" x-show="opp.property_address" x-text="opp.property_address"></div>
                                        <div class="opportunity-actions">
                                            <template x-for="action in opp.action_sequence.slice(0, 2)" :key="action.action">
                                                <button class="btn btn-sm btn-primary" @click="executeAction(opp.id, action.action, opp.lead_email)">
                                                    <span x-text="action.description"></span>
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                
                                <div x-show="opportunities.length === 0" class="empty-state-small">
                                    <div class="empty-state-icon">‚úì</div>
                                    <div class="empty-state-text">No urgent opportunities</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-column">
                            <div class="d-flex justify-between align-center mb-4">
                                <div class="section-label admin-section-label">
                                  <span class="section-label-line"></span>
                                  <span class="section-label-text">Recent Activity</span>
                                  <span class="section-label-line"></span>
                                </div>
                                <a href="/admin/business-intelligence" class="view-all">View All ‚Üí</a>
                            </div>
                            
                            <div class="activity-feed-compact">
                                <template x-for="activity in recentActivity.slice(0, 5)" :key="activity.id">
                                    <div class="activity-item-compact">
                                        <div class="activity-icon-compact" :style="`background-color: ${getActivityColor(activity.type)}`">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" :d="getActivityIconPath(activity.type)"></path>
                                            </svg>
                                        </div>
                                        <div class="activity-content-compact">
                                            <div class="activity-title-compact" x-text="activity.title"></div>
                                            <div class="activity-time-compact" x-text="formatTimeAgo(activity.timestamp)"></div>
                                        </div>
                                    </div>
                                </template>
                                
                                <div x-show="recentActivity.length === 0" class="empty-state-small">
                                    <div class="empty-state-text">No recent activity</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="dashboard-section">
                    <div class="section-label admin-section-label">
                      <span class="section-label-line"></span>
                      <span class="section-label-text">Performance Overview</span>
                      <span class="section-label-line"></span>
                    </div>
                    <div class="charts-grid charts-grid-2">
                        <div class="chart-card">
                            <div class="chart-card-header">
                                <h3 class="chart-card-title">Booking Trends</h3>
                                <p class="chart-card-subtitle">Last 7 days</p>
                            </div>
                            <div class="chart-card-body">
                                <canvas x-ref="bookingTrendsChart" class="chart-canvas"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-card-header">
                                <h3 class="chart-card-title">Lead Sources</h3>
                                <p class="chart-card-subtitle">Current month</p>
                            </div>
                            <div class="chart-card-body">
                                <canvas x-ref="leadSourceChart" class="chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Live Sessions Panel - Who's Browsing Now -->
                <section class="dashboard-section">
                    <div class="live-sessions-panel" x-data="liveSessionsPanel()" x-init="init()">
                        <div class="live-sessions-header">
                            <h3 class="live-sessions-title">
                                <span class="pulse-dot"></span>
                                Active Visitors
                                <span class="live-sessions-count" x-text="sessions.length"></span>
                            </h3>
                            <a href="/admin/sessions" class="view-all-link">
                                View All 
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>
                        </div>
                        
                        <div x-show="loading" class="sessions-loading">
                            <div class="sessions-loading-spinner"></div>
                        </div>
                        
                        <div x-show="!loading && sessions.length === 0" class="sessions-empty-state">
                            <div class="sessions-empty-icon">üë•</div>
                            <div class="sessions-empty-text">No active visitors right now</div>
                        </div>
                        
                        <div x-show="!loading && sessions.length > 0" class="sessions-list">
                            <template x-for="session in sessions.slice(0, 5)" :key="session.session_id">
                                <div class="session-card" :class="'score-' + session.score_category" @click="viewJourney(session.session_id)">
                                    <div class="session-header">
                                        <div class="session-identity">
                                            <span class="session-status-indicator" x-text="getStatusIcon(session.score_category)"></span>
                                            <div class="session-identity-details">
                                                <div class="session-email" :class="{ 'anonymous': session.is_anonymous }" x-text="session.is_anonymous ? 'Anonymous Visitor' : (session.lead_email || session.lead_name)"></div>
                                                <div class="session-location" x-show="session.location.city || session.location.state">
                                                    <svg class="session-location-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                    </svg>
                                                    <span x-text="getLocationString(session.location)"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="session-score" :class="session.score_category">
                                            <span>Score: <span x-text="session.behavioral_score"></span></span>
                                            <span x-text="'(' + getCategoryLabel(session.score_category) + ')'"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="session-activity">
                                        <div class="session-current-activity">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                            </svg>
                                            <span x-text="session.current_page"></span>
                                        </div>
                                        <div x-show="session.current_property" class="session-property-address" x-text="session.current_property ? session.current_property.address : ''"></div>
                                    </div>
                                    
                                    <div class="session-metrics">
                                        <div class="session-metric">
                                            <svg class="session-metric-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <span x-text="session.page_views + ' pages'"></span>
                                        </div>
                                        <div class="session-metric">
                                            <svg class="session-metric-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <span x-text="formatDuration(session.session_duration)"></span>
                                        </div>
                                        <div class="session-metric" x-show="session.device_type">
                                            <svg class="session-metric-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                            </svg>
                                            <span x-text="session.device_type"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="session-actions">
                                        <button class="session-action-btn primary" @click.stop="viewJourney(session.session_id)">
                                            View Journey
                                        </button>
                                        <button class="session-action-btn" @click.stop="identifyLead(session)" x-show="session.is_anonymous">
                                            Identify Lead
                                        </button>
                                        <button class="session-action-btn" @click.stop="sendProperty(session)" x-show="!session.is_anonymous">
                                            Send Property
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </section>

                <section class="dashboard-section dashboard-system-status">
                    <div class="system-status-indicator" :class="systemHealthClass">
                        <span class="status-icon">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" :d="systemHealth.status === 'healthy' ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'"></path>
                            </svg>
                        </span>
                        <div class="status-content">
                            <span class="status-text" x-text="systemHealthText"></span>
                            <span class="status-details" x-text="systemHealth.uptime_percent + '% uptime ‚Ä¢ ' + systemHealth.avg_response_time_ms + 'ms avg response'"></span>
                        </div>
                        <a href="/admin/security" class="status-link">Details ‚Üí</a>
                    </div>
                </section>
            </div>
        </main>
        
        <div class="toast-container" x-data="toastManager()">
            <template x-for="toast in toasts" :key="toast.id">
                <div class="toast" :class="`toast-${toast.type}`" x-show="toast.visible" x-transition:enter="transition-fast" x-transition:leave="transition-fast">
                    <div class="toast-icon" x-text="getToastIcon(toast.type)"></div>
                    <div class="toast-message" x-text="toast.message"></div>
                    <button class="toast-close" @click="remove(toast.id)">√ó</button>
                </div>
            </template>
        </div>
    </div>
    
    <script>
        function dashboardData() {
            return {
                chartColors: {
                    primary: '#1b3559',
                    secondary: '#c4a962',
                    success: '#10B981',
                    warning: '#F59E0B',
                    error: '#EF4444',
                    info: '#3B82F6'
                },
                
                criticalStats: {
                    pendingBookings: 0,
                    pendingApplications: 0,
                    alerts: 0
                },
                
                keyMetrics: {
                    activeLeads: 0,
                    activeLeadsTrend: 0,
                    conversionRate: 0,
                    revenueMTD: 0,
                    revenueTrend: 0,
                    bookingsWeek: 0,
                    confirmedBookings: 0
                },
                
                opportunities: [],
                recentActivity: [],
                
                systemHealth: {
                    status: 'healthy',
                    uptime_percent: 99.9,
                    avg_response_time_ms: 120,
                    error_rate_percent: 0.1
                },
                
                sidebarCounts: {
                    total_leads: 0,
                    hot_leads: 0,
                    warm_leads: 0,
                    active_properties: 0,
                    pending_applications: 0,
                    confirmed_bookings: 0,
                    closing_pipeline: 0,
                    pending_images: 0
                },
                
                userProfile: {
                    username: 'Loading...',
                    role: 'Loading...',
                    initials: 'U'
                },
                
                loadingOpportunities: true,
                searchQuery: '',
                bookingTrendsChart: null,
                leadSourceChart: null,
                
                async init() {
                    await this.fetchUserProfile();
                    await Promise.all([
                        this.fetchCriticalStats(),
                        this.fetchKeyMetrics(),
                        this.fetchOpportunities(),
                        this.fetchRecentActivity(),
                        this.fetchChartData(),
                        this.fetchSystemHealth()
                    ]);
                    this.renderCharts();
                },
                
                async fetchUserProfile() {
                    try {
                        const response = await fetch('/api/admin/settings/profile');
                        const data = await response.json();
                        this.userProfile = {
                            username: data.username || 'User',
                            role: data.role || 'Unknown',
                            initials: this.getUserInitials(data.username)
                        };
                    } catch (error) {
                        console.error('Failed to fetch user profile:', error);
                        this.userProfile = { username: 'User', role: 'Unknown', initials: 'U' };
                    }
                },
                
                getUserInitials(name) {
                    if (!name) return 'U';
                    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                },
                
                async fetchCriticalStats() {
                    try {
                        const response = await fetch('/api/stats/critical');
                        const data = await response.json();
                        this.criticalStats = {
                            pendingBookings: data.pending_bookings || 0,
                            pendingApplications: data.pending_applications || 0,
                            alerts: data.system_alerts || 0
                        };
                        this.sidebarCounts.pending_applications = data.pending_applications || 0;
                    } catch (error) {
                        console.error('Failed to fetch critical stats:', error);
                    }
                },
                
                async fetchKeyMetrics() {
                    try {
                        const response = await fetch('/api/stats/key-metrics');
                        const data = await response.json();
                        this.keyMetrics = {
                            activeLeads: data.active_leads || 0,
                            activeLeadsTrend: data.active_leads_trend || 0,
                            conversionRate: data.conversion_rate || 0,
                            revenueMTD: data.revenue_mtd || 0,
                            revenueTrend: data.revenue_trend || 0,
                            bookingsWeek: data.bookings_week || 0,
                            confirmedBookings: data.confirmed_bookings || 0
                        };
                        this.sidebarCounts.total_leads = data.active_leads || 0;
                        this.sidebarCounts.hot_leads = data.hot_leads || 0;
                        this.sidebarCounts.warm_leads = data.warm_leads || 0;
                        this.sidebarCounts.confirmed_bookings = data.bookings_week || 0;
                    } catch (error) {
                        console.error('Failed to fetch key metrics:', error);
                    }
                },
                
                async fetchOpportunities() {
                    this.loadingOpportunities = true;
                    try {
                        const response = await fetch('/api/stats/opportunities?limit=4');
                        const data = await response.json();
                        this.opportunities = data.opportunities || [];
                    } catch (error) {
                        console.error('Failed to fetch opportunities:', error);
                    } finally {
                        this.loadingOpportunities = false;
                    }
                },
                
                async fetchRecentActivity() {
                    try {
                        const response = await fetch('/api/stats/activity?limit=5');
                        const data = await response.json();
                        this.recentActivity = data.activities || [];
                    } catch (error) {
                        console.error('Failed to fetch recent activity:', error);
                    }
                },
                
                async fetchChartData() {
                    try {
                        const [bookingResponse, leadSourceResponse] = await Promise.all([
                            fetch('/api/charts/bookings'),
                            fetch('/api/charts/lead-sources')
                        ]);
                        
                        this.bookingTrendsData = await bookingResponse.json();
                        this.leadSourceData = await leadSourceResponse.json();
                    } catch (error) {
                        console.error('Failed to fetch chart data:', error);
                    }
                },
                
                async fetchSystemHealth() {
                    try {
                        const response = await fetch('/api/admin/system/health');
                        const data = await response.json();
                        this.systemHealth = {
                            status: data.status || 'healthy',
                            uptime_percent: data.uptime_percent || 99.9,
                            avg_response_time_ms: data.avg_response_time_ms || 120,
                            error_rate_percent: data.error_rate_percent || 0.1
                        };
                        this.sidebarCounts.active_properties = data.active_properties || 0;
                        this.sidebarCounts.pending_images = data.pending_images || 0;
                        this.sidebarCounts.closing_pipeline = data.closing_pipeline || 0;
                    } catch (error) {
                        console.error('Failed to fetch system health:', error);
                    }
                },
                
                renderCharts() {
                    this.$nextTick(() => {
                        this.renderBookingTrendsChart();
                        this.renderLeadSourceChart();
                    });
                },
                
                renderBookingTrendsChart() {
                    const ctx = this.$refs.bookingTrendsChart;
                    if (!ctx) return;
                    
                    if (this.bookingTrendsChart) {
                        this.bookingTrendsChart.destroy();
                    }
                    
                    this.bookingTrendsChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: this.bookingTrendsData?.labels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Bookings',
                                data: this.bookingTrendsData?.data || [12, 19, 15, 25, 22, 18, 20],
                                borderColor: this.chartColors.primary,
                                backgroundColor: this.chartColors.primary + '20',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                },
                
                renderLeadSourceChart() {
                    const ctx = this.$refs.leadSourceChart;
                    if (!ctx) return;
                    
                    if (this.leadSourceChart) {
                        this.leadSourceChart.destroy();
                    }
                    
                    this.leadSourceChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: this.leadSourceData?.labels || ['Website', 'Referral', 'Social Media', 'Direct'],
                            datasets: [{
                                data: this.leadSourceData?.data || [45, 25, 20, 10],
                                backgroundColor: [
                                    this.chartColors.primary,
                                    this.chartColors.secondary,
                                    this.chartColors.info,
                                    this.chartColors.success
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                },
                
                get systemHealthClass() {
                    if (this.systemHealth.status === 'healthy') return 'healthy';
                    if (this.systemHealth.status === 'warning') return 'warning';
                    return 'critical';
                },
                
                get systemHealthText() {
                    if (this.systemHealth.status === 'healthy') return 'All Systems Operational';
                    if (this.systemHealth.status === 'warning') return 'Minor Issues Detected';
                    return 'Critical Issues Detected';
                },
                
                async executeAction(oppId, action, email) {
                    console.log('Executing action:', action, 'for opportunity:', oppId);
                },
                
                getActivityColor(type) {
                    const colors = {
                        'lead': this.chartColors.info,
                        'booking': this.chartColors.success,
                        'application': this.chartColors.secondary,
                        'message': this.chartColors.primary
                    };
                    return colors[type] || this.chartColors.info;
                },
                
                getActivityIconPath(type) {
                    const paths = {
                        'lead': 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z',
                        'booking': 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z',
                        'application': 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z',
                        'message': 'M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z'
                    };
                    return paths[type] || paths.lead;
                },
                
                formatTimeAgo(timestamp) {
                    const now = new Date();
                    const past = new Date(timestamp);
                    const diffInSeconds = Math.floor((now - past) / 1000);
                    
                    if (diffInSeconds < 60) return 'Just now';
                    if (diffInSeconds < 3600) return Math.floor(diffInSeconds / 60) + 'm ago';
                    if (diffInSeconds < 86400) return Math.floor(diffInSeconds / 3600) + 'h ago';
                    return Math.floor(diffInSeconds / 86400) + 'd ago';
                },
                
                formatCurrency(value) {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(value);
                },
                
                performSearch() {
                    console.log('Searching for:', this.searchQuery);
                }
            };
        }
        
        function statCard(metricName) {
            return {
                displayValue: 0,
                targetValue: 0,
                
                init() {
                    this.$watch(() => {
                        const parent = this.$el.closest('[x-data*="dashboardData"]');
                        if (!parent) return 0;
                        const data = Alpine.$data(parent);
                        
                        switch(metricName) {
                            case 'active_leads': return data.keyMetrics.activeLeads;
                            case 'conversion_rate': return data.keyMetrics.conversionRate;
                            case 'revenue_mtd': return data.keyMetrics.revenueMTD;
                            case 'bookings_week': return data.keyMetrics.bookingsWeek;
                            default: return 0;
                        }
                    }, (newValue) => {
                        this.targetValue = newValue;
                        this.animateValue();
                    });
                },
                
                animateValue() {
                    const duration = 1000;
                    const start = this.displayValue;
                    const end = this.targetValue;
                    const startTime = performance.now();
                    
                    const animate = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        this.displayValue = start + (end - start) * this.easeOutQuart(progress);
                        
                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        }
                    };
                    
                    requestAnimationFrame(animate);
                },
                
                easeOutQuart(x) {
                    return 1 - Math.pow(1 - x, 4);
                }
            };
        }
        
        function visitorCounter() {
            return {
                count: 0,
                trend: 0,
                byPage: {},
                hotCount: 0,
                returningCount: 0,
                justChanged: false,
                showBreakdown: false,
                ws: null,
                reconnectAttempts: 0,
                maxReconnectAttempts: 5,
                
                init() {
                    this.fetchCount();
                    this.connectWebSocket();
                },
                
                connectWebSocket() {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}/api/ws`;
                    
                    try {
                        this.ws = new WebSocket(wsUrl);
                        
                        this.ws.onopen = () => {
                            console.log('WebSocket connected');
                            this.reconnectAttempts = 0;
                        };
                        
                        this.ws.onmessage = (event) => {
                            try {
                                const message = JSON.parse(event.data);
                                if (message.type === 'visitor_count') {
                                    this.updateCount(message.data);
                                }
                            } catch (e) {
                                console.error('Error parsing WebSocket message:', e);
                            }
                        };
                        
                        this.ws.onerror = (error) => {
                            console.error('WebSocket error:', error);
                        };
                        
                        this.ws.onclose = () => {
                            console.log('WebSocket disconnected');
                            if (this.reconnectAttempts < this.maxReconnectAttempts) {
                                this.reconnectAttempts++;
                                const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
                                setTimeout(() => this.connectWebSocket(), delay);
                            }
                        };
                    } catch (e) {
                        console.error('Error creating WebSocket:', e);
                    }
                },
                
                updateCount(data) {
                    const oldCount = this.count;
                    this.count = data.count || 0;
                    this.trend = data.trend || 0;
                    this.byPage = data.by_page || {};
                    this.hotCount = data.hot_count || 0;
                    this.returningCount = data.returning_count || 0;
                    
                    if (oldCount !== this.count) {
                        this.justChanged = true;
                        setTimeout(() => this.justChanged = false, 1000);
                    }
                },
                
                async fetchCount() {
                    try {
                        const res = await fetch('/api/stats/live');
                        const data = await res.json();
                        this.updateCount({
                            count: data.active_visitors || 0,
                            trend: data.visitors_trend || 0,
                            by_page: data.visitors_by_page || {},
                            hot_count: data.hot_visitors || 0,
                            returning_count: data.returning_visitors || 0
                        });
                    } catch (error) {
                        console.error('Failed to fetch visitor count:', error);
                    }
                }
            };
        }
        
        function toastManager() {
            return {
                toasts: [],
                nextId: 1,
                
                add(message, type = 'info', duration = 5000) {
                    const id = this.nextId++;
                    const toast = { id, message, type, visible: true };
                    this.toasts.push(toast);
                    
                    setTimeout(() => {
                        this.remove(id);
                    }, duration);
                },
                
                remove(id) {
                    const index = this.toasts.findIndex(t => t.id === id);
                    if (index !== -1) {
                        this.toasts[index].visible = false;
                        setTimeout(() => {
                            this.toasts.splice(index, 1);
                        }, 300);
                    }
                },
                
                getToastIcon(type) {
                    const icons = {
                        success: '‚úì',
                        error: '‚úï',
                        warning: '‚ö†',
                        info: '‚Ñπ'
                    };
                    return icons[type] || icons.info;
                }
            };
        }
        
        function liveSessionsPanel() {
            return {
                sessions: [],
                loading: true,
                selectedSession: null,
                showJourneyModal: false,
                journeyData: null,
                updateInterval: null,
                
                async init() {
                    await this.fetchSessions();
                    // Poll for updates every 10 seconds
                    this.updateInterval = setInterval(() => {
                        this.fetchSessions();
                    }, 10000);
                },
                
                async fetchSessions() {
                    try {
                        const response = await fetch('/api/admin/sessions/active');
                        const data = await response.json();
                        
                        // Mark new sessions for animation
                        const newSessionIds = data.sessions.map(s => s.session_id);
                        const oldSessionIds = this.sessions.map(s => s.session_id);
                        
                        this.sessions = data.sessions.map(session => {
                            const isNew = !oldSessionIds.includes(session.session_id);
                            return { ...session, isNew };
                        });
                        
                        this.loading = false;
                    } catch (error) {
                        console.error('Failed to fetch sessions:', error);
                        this.loading = false;
                    }
                },
                
                async viewJourney(sessionId) {
                    try {
                        const response = await fetch(`/api/admin/sessions/${sessionId}/journey`);
                        const data = await response.json();
                        this.journeyData = data;
                        this.showJourneyModal = true;
                    } catch (error) {
                        console.error('Failed to fetch session journey:', error);
                    }
                },
                
                closeJourneyModal() {
                    this.showJourneyModal = false;
                    this.journeyData = null;
                },
                
                identifyLead(session) {
                    console.log('Identify lead for session:', session.session_id);
                    // TODO: Open modal to identify anonymous lead
                },
                
                sendProperty(session) {
                    console.log('Send property to:', session.lead_email);
                    // TODO: Open modal to send property recommendation
                },
                
                getStatusIcon(category) {
                    const icons = {
                        'hot': 'üî¥',
                        'warm': 'üü°',
                        'cold': 'üîµ'
                    };
                    return icons[category] || 'üîµ';
                },
                
                getCategoryLabel(category) {
                    const labels = {
                        'hot': 'Hot',
                        'warm': 'Warm',
                        'cold': 'Cold'
                    };
                    return labels[category] || 'Cold';
                },
                
                getLocationString(location) {
                    if (!location) return '';
                    const parts = [];
                    if (location.city) parts.push(location.city);
                    if (location.state) parts.push(location.state);
                    return parts.join(', ');
                },
                
                formatDuration(seconds) {
                    if (seconds < 60) return `${seconds}s`;
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    return `${minutes}m ${remainingSeconds}s`;
                },
                
                formatTime(timestamp) {
                    const date = new Date(timestamp);
                    return date.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                },
                
                formatEventType(eventType) {
                    const types = {
                        'viewed': 'Viewed Property',
                        'saved': 'Saved Property',
                        'inquired': 'Sent Inquiry',
                        'applied': 'Submitted Application',
                        'searched': 'Searched Properties',
                        'session_start': 'Started Session'
                    };
                    return types[eventType] || eventType;
                },
                
                destroy() {
                    if (this.updateInterval) {
                        clearInterval(this.updateInterval);
                    }
                }
            };
        }
    </script>
    
    <!-- Session Journey Modal -->
    <template x-if="showJourneyModal" x-data="{ show: showJourneyModal }">
        <div class="session-journey-modal" @click.self="closeJourneyModal()" x-show="show" x-transition>
            <div class="session-journey-content">
                <div class="session-journey-header">
                    <h3 class="session-journey-title">Session Journey</h3>
                    <button class="session-journey-close" @click="closeJourneyModal()">&times;</button>
                </div>
                <div class="session-journey-body">
                    <div x-show="journeyData">
                        <div style="margin-bottom: 2rem;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div style="padding: 1rem; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.5rem;">Duration</div>
                                    <div style="font-size: 1.25rem; font-weight: 600;" x-text="journeyData ? Math.floor(journeyData.duration / 60) + 'm ' + (journeyData.duration % 60) + 's' : ''"></div>
                                </div>
                                <div style="padding: 1rem; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.5rem;">Page Views</div>
                                    <div style="font-size: 1.25rem; font-weight: 600;" x-text="journeyData ? journeyData.page_views : ''"></div>
                                </div>
                                <div style="padding: 1rem; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.5rem;">Total Events</div>
                                    <div style="font-size: 1.25rem; font-weight: 600;" x-text="journeyData ? journeyData.total_events : ''"></div>
                                </div>
                            </div>
                            
                            <h4 style="font-family: var(--font-family-primary); font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--navy-primary);">Activity Timeline</h4>
                            <div class="session-timeline">
                                <template x-for="event in journeyData?.timeline || []" :key="event.timestamp">
                                    <div class="timeline-item">
                                        <div class="timeline-time" x-text="formatTime(event.timestamp)"></div>
                                        <div class="timeline-content">
                                            <div class="timeline-event-type" x-text="formatEventType(event.event_type)"></div>
                                            <div x-show="event.property" class="timeline-property">
                                                <div class="timeline-property-info">
                                                    <div class="timeline-property-address" x-text="event.property?.address"></div>
                                                    <div class="timeline-property-price" x-text="event.property ? '$' + event.property.price.toLocaleString() : ''"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
</body>
</html>
