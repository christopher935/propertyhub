<!DOCTYPE html>

<html lang="en">
{{template "_head.html" .}}
<body class="scout-consumer-layout page-properties-grid">
{{template "_svg_sprite.html"}}
<!-- Navigation -->
{{template "_nav.html" .}}
<!-- Hero Section with Search -->
<section class="hero properties-hero-compact">
<div class="hero-container">
<div class="hero-content">
<div class="hero-text">
<h1 class="text-heading-1 text-navy">Find Your Perfect Home</h1>
<p>Browse our collection of premium Houston rental properties</p>
<!-- Search Bar -->
<div class="properties-search-compact">
<input aria-label="Search properties" class="form-input" id="searchInput" placeholder="Search by address, neighborhood, or ZIP code..." type="text"/>
<button aria-label="Search" class="btn btn-primary" type="button">
<svg height="20" width="20"><use href="#icon-magnifying-glass"></use></svg>
</button>
</div>
</div>
</div>
</div>
</section>
<!-- Search Journey Progress -->
<div class="container">
<div class="search-journey" x-data="searchJourney()" x-show="hasActivity">
    <div class="journey-progress">
        <div class="journey-step" :class="{ 'completed': viewedProperties > 0 }">
            <svg class="inline-icon" height="20" width="20"><use href="#icon-eye"></use></svg>
            <span class="step-label">Browsing</span>
        </div>
        <div class="journey-connector"></div>
        <div class="journey-step" :class="{ 'completed': savedProperties > 0 }">
            <svg class="inline-icon" height="20" width="20" style="color: var(--red-600);"><use href="#icon-star"></use></svg>
            <span class="step-label">Saved <span x-text="savedProperties"></span></span>
        </div>
        <div class="journey-connector"></div>
        <div class="journey-step" :class="{ 'active': savedProperties > 0 && !hasBooked }">
            <svg class="inline-icon" height="20" width="20"><use href="#icon-calendar"></use></svg>
            <span class="step-label">Schedule Tour</span>
        </div>
        <div class="journey-connector"></div>
        <div class="journey-step">
            <svg class="inline-icon" height="20" width="20"><use href="#icon-home"></use></svg>
            <span class="step-label">Find Home</span>
        </div>
    </div>
    <p class="journey-encouragement" x-text="getEncouragement()"></p>
</div>
</div>

<!-- Filters Section -->
<section class="features properties-filters-section">
<div class="features-container">
<!-- Quick Filters -->
<div class="properties-filters">
<button class="filter-pill active" data-filter="all">All Properties</button>
<button class="filter-pill" data-filter="price-low">Under $3,500</button>
<button class="filter-pill" data-filter="price-mid">$3,500 - $4,500</button>
<button class="filter-pill" data-filter="price-high">Over $4,500</button>
<button class="filter-pill" data-filter="pet-friendly">Pet Friendly</button>
<button class="filter-pill" data-filter="single-story">Single Story</button>
<button class="filter-pill" data-filter="available">Available Now</button>
</div>
<!-- Active Filters Display -->
<div class="active-filters" id="activeFilters" style="display: none;"></div>
<!-- Advanced Filters -->
<div class="properties-advanced-filters">
<div class="filter-group">
<label class="filter-group-label" for="bedroomFilter">Bedrooms</label>
<select aria-label="Filter by bedrooms" class="form-select filter-group-select" id="bedroomFilter">
<option value="">Any</option>
<option value="1">1+</option>
<option value="2">2+</option>
<option value="3">3+</option>
<option value="4">4+</option>
<option value="5">5+</option>
</select>
</div>
<div class="filter-group">
<label class="filter-group-label" for="bathroomFilter">Bathrooms</label>
<select aria-label="Filter by bathrooms" class="form-select filter-group-select" id="bathroomFilter">
<option value="">Any</option>
<option value="1">1+</option>
<option value="2">2+</option>
<option value="3">3+</option>
<option value="4">4+</option>
</select>
</div>
<div class="filter-group">
<label class="filter-group-label" for="locationFilter">Location</label>
<select aria-label="Filter by location" class="form-select filter-group-select" id="locationFilter">
<option value="">All Houston</option>
<option value="montrose">Montrose</option>
<option value="sugar-land">Sugar Land</option>
<option value="katy">Katy</option>
<option value="the-woodlands">The Woodlands</option>
<option value="memorial">Memorial</option>
</select>
</div>
<div class="filter-group">
<label class="filter-group-label" for="sortSelect">Sort By</label>
<select aria-label="Sort properties" class="form-select filter-group-select" id="sortSelect">
<option value="newest">Newest First</option>
<option value="price-low">Price: Low to High</option>
<option value="price-high">Price: High to Low</option>
<option value="bedrooms">Most Bedrooms</option>
<option value="size">Largest Size</option>
</select>
</div>
<button aria-label="Clear all filters" class="btn btn-secondary clear-filters-btn">Clear All</button>
</div>
</div>
</section>
<!-- AI Recommendations Section -->
<section class="ai-recommendations-section" id="aiRecommendations" style="display: none;" x-data="aiRecommendations()" x-init="load()">
<div class="properties-container">
<div class="ai-header">
<svg class="ai-icon" height="24" width="24"><use href="#icon-sparkles"></use></svg>
<div class="section-label">
  <span class="section-label-line"></span>
  <span class="section-label-text">Recommended For You</span>
  <span class="section-label-line"></span>
</div>
</div>
<p class="ai-explanation" x-show="explanation" x-text="explanation"></p>
<div class="recommendation-carousel" x-show="recommendations.length > 0">
<template x-for="property in recommendations" :key="property.id">
<div class="property-card recommendation-card">
<div class="property-image">
<img x-show="property.featured_image" :src="property.featured_image" :alt="property.address" loading="lazy">
<div x-show="!property.featured_image" class="property-placeholder">
<svg height="120" width="120" style="color: var(--gray-400);"><use href="#icon-home"></use></svg>
</div>
<span class="badge badge-ai-pick">AI Pick</span>
</div>
<div class="property-details">
<h3 class="property-title">
<a :href="'/properties/' + property.id" x-text="property.address"></a>
</h3>
<p class="property-location">
<svg height="16" width="16"><use href="#icon-map-pin"></use></svg>
<span x-text="property.city + ', TX'"></span>
</p>
<div class="property-price" x-text="'$' + property.price.toLocaleString() + '/month'"></div>
<p class="property-specs" x-text="property.bedrooms + ' bed \u2022 ' + property.bathrooms + ' bath \u2022 ' + property.square_feet.toLocaleString() + ' sq ft'"></p>
<a class="btn btn-primary" :href="'/book-showing?property=' + property.id">Schedule A Tour</a>
</div>
</div>
</template>
</div>
</div>
</section>

<!-- Results Section -->
<section class="properties-section">
<div class="properties-container">
<!-- Results Header -->
<div class="properties-header">
<div class="properties-count">
<span class="count-number">{{len .Properties}}</span>
<span class="count-label">properties found</span>
</div>
</div>
<!-- Loading Skeleton (shown while loading) -->
<div aria-hidden="true" class="properties-grid loading-skeleton hidden" id="loadingSkeleton">
<div class="property-card loading">
<div class="skeleton skeleton-image"></div>
<div class="property-details">
<div class="skeleton skeleton-text"></div>
<div class="skeleton skeleton-text short"></div>
<div class="skeleton skeleton-text"></div>
</div>
</div>
<div class="property-card loading">
<div class="skeleton skeleton-image"></div>
<div class="property-details">
<div class="skeleton skeleton-text"></div>
<div class="skeleton skeleton-text short"></div>
<div class="skeleton skeleton-text"></div>
</div>
</div>
<div class="property-card loading">
<div class="skeleton skeleton-image"></div>
<div class="property-details">
<div class="skeleton skeleton-text"></div>
<div class="skeleton skeleton-text short"></div>
<div class="skeleton skeleton-text"></div>
</div>
</div>
</div>
<!-- Property Grid -->
<div class="properties-grid" id="propertyGrid">
            {{range .Properties}}
            <div class="property-card" data-bathrooms="{{.Bathrooms}}" data-bedrooms="{{.Bedrooms}}" data-location="{{.Neighborhood}}" data-price="{{.MonthlyRent}}">
<div class="property-image">
                    {{if .FeaturedImage}}
                    <img alt="{{.Address}}" loading="lazy" src="{{.FeaturedImage}}" onerror="this.style.display='none'; this.parentElement.querySelector('.property-placeholder').style.display='flex'"/>
                    {{else if .Images}}
                    <img alt="{{.Address}}" loading="lazy" src="{{index .Images 0}}" onerror="this.style.display='none'; this.parentElement.querySelector('.property-placeholder').style.display='flex'"/>
                    {{end}}
                    <div class="property-placeholder" style="{{if or .FeaturedImage .Images}}display: none;{{else}}display: flex;{{end}}">
                        <svg height="120" width="120" style="color: var(--gray-400);"><use href="#icon-home"></use></svg>
                    </div>
                    <div class="property-badges">
                        <span class="badge badge-{{if eq .Status "available"}}success{{else if eq .Status "just-listed"}}info{{else}}secondary{{end}}">
                            {{if eq .Status "available"}}Available{{else if eq .Status "just-listed"}}New Listing{{else}}For Rent{{end}}
                        </span>
                        {{if .Featured}}
                        <span class="badge badge-featured">
                            <svg class="badge-icon"><use href="#icon-star"></use></svg> Featured
                        </span>
                        {{end}}
                        {{if .ViewCount}}{{if gt .ViewCount 50}}
                        <span class="badge badge-hot">
                            <svg class="badge-icon"><use href="#icon-fire"></use></svg> Popular
                        </span>
                        {{end}}{{end}}
                    </div>
</div>
<div class="property-details">
<h3 class="property-title">
<a href="/properties/{{.ID}}">{{.Address}}</a>
</h3>
<p class="property-location">
<svg height="16" width="16"><use href="#icon-map-pin"></use></svg>
                        {{.Neighborhood}}, {{.City}}, TX {{.ZipCode}}
                    </p>
<div class="property-price">${{.MonthlyRent}}/month</div>
<p class="property-specs">{{.Bedrooms}} bed • {{.Bathrooms}} bath • {{.SquareFeet}} sq ft</p>
<a class="btn btn-primary" href="/book-showing?property={{.ID}}">Schedule A Tour</a>
</div>
</div>
            {{end}}
        </div>
<!-- Empty State (hidden by default, shown when no results) -->
<div aria-live="polite" class="properties-empty-state hidden" id="emptyState" role="status">
<div class="empty-state-icon">
<svg height="80" width="80"><use href="#icon-magnifying-glass"></use></svg>
</div>
<h3 class="text-heading-3 text-navy">No Properties Found</h3>
<p>We couldn't find any properties matching your criteria. Try adjusting your filters or check back soon for new listings.</p>
<div>
<button class="btn btn-secondary clear-filters-btn">Clear Filters</button>
<a class="btn btn-primary" href="/contact">Contact Us</a>
</div>
</div>
</div>
</section>
<!-- Footer -->
{{template "_footer.html"}}
<script>
    // Filter pill functionality
    document.querySelectorAll('.filter-pill').forEach(pill => {
        pill.addEventListener('click', function() {
            document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
            this.classList.add('active');
            const filter = this.dataset.filter;
            console.log('Filter selected:', filter);
            // Filter logic would be implemented here
        });
    });

    // Clear filters
    document.querySelectorAll('.clear-filters-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Reset all selects
            document.querySelectorAll('.form-select').forEach(select => {
                select.selectedIndex = 0;
            });
            // Reset to "All Properties" pill
            document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
            document.querySelector('.filter-pill[data-filter="all"]')?.classList.add('active');
            // Hide empty state if showing
            document.getElementById('emptyState')?.classList.add('hidden');
            // Show property grid
            document.getElementById('propertyGrid')?.classList.remove('hidden');
        });
    });

    // Show/hide empty state based on results
    document.addEventListener('DOMContentLoaded', function() {
        const propertyGrid = document.getElementById('propertyGrid');
        const emptyState = document.getElementById('emptyState');
        const loadingSkeleton = document.getElementById('loadingSkeleton');
        
        // Hide loading skeleton after page load
        if (loadingSkeleton) {
            loadingSkeleton.classList.add('hidden');
        }
        
        // Check if there are no properties
        if (propertyGrid && propertyGrid.children.length === 0) {
            propertyGrid.classList.add('hidden');
            emptyState?.classList.remove('hidden');
        }
    });
</script>
{{template "_scripts.html" .}}
<script>
function aiRecommendations() {
return {
recommendations: [],
explanation: '',
async load() {
const sessionId = localStorage.getItem('property_session_id') || '';
try {
const url = sessionId ? 
`/api/recommendations?session_id=${sessionId}&limit=6` :
`/api/recommendations?limit=6`;
const response = await fetch(url);
if (!response.ok) return;
const data = await response.json();
if (data.recommendations && data.recommendations.length > 0) {
this.recommendations = data.recommendations.map(rec => ({
id: rec.property.id,
address: rec.property.address,
city: rec.property.city,
price: rec.property.price,
bedrooms: rec.property.bedrooms,
bathrooms: rec.property.bathrooms,
square_feet: rec.property.square_feet,
featured_image: rec.property.featured_image
}));
if (data.personalized) {
this.explanation = '\u2728 These properties match your browsing preferences';
document.getElementById('aiRecommendations').style.display = 'block';
} else {
this.explanation = 'Trending properties in your area';
document.getElementById('aiRecommendations').style.display = 'block';
}
}
} catch (error) {
console.error('Error loading AI recommendations:', error);
}
}
}
}
</script>
<script src="/static/js/property-search.js"></script>
</body>
</html>
