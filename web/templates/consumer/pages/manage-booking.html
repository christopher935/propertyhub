<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Manage Your Booking | Landlords of Texas</title>
<meta content="View and manage your property tour bookings with Landlords of Texas." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="/static/css/design-tokens.css" rel="stylesheet"/>
<link href="/static/css/scout-utilities.css" rel="stylesheet"/>
<link href="/static/css/scout-layouts.css" rel="stylesheet"/>
<link href="/static/css/scout-components.css" rel="stylesheet"/>
</head>
<body>
<!-- SVG Icon Sprite -->
<svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg">
<symbol fill="none" id="icon-home" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-calendar" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-clock" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-map-pin" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" stroke-linecap="round" stroke-linejoin="round"></path>
<path d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-user" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-envelope" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-phone" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-check-circle" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-x-circle" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-info" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
<symbol fill="none" id="icon-x" stroke="currentColor" stroke-width="1.5" viewbox="0 0 24 24">
<path d="M6 18 18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
</symbol>
</svg>
<!-- Navigation -->
<nav class="header">
<div class="nav">
<a class="logo" href="/">
<svg class="logo-icon" height="32" width="32"><use href="#icon-home"></use></svg>
<span class="logo-text">Landlords of Texas</span>
</a>
<div class="nav-menu">
<a class="nav-link" href="/">Home</a>
<a class="nav-link" href="/properties">Properties</a>
<a class="nav-link" href="/about">About</a>
<a class="nav-link" href="/contact">Contact</a>
<a class="btn btn-outline" href="/login">Login</a>
</div>
</div>
</nav>
<!-- Main Content -->
<main>
<!-- Hero Section -->
<section class="section">
<div class="container">
<div class="hero-header">
<h1 class="text-heading-1 text-navy mb-4">Manage Your Booking</h1>
<p class="text-body-lg text-gray-600">View details and make changes to your property tour</p>
</div>

            {{if .Booking}}
            <!-- Two Column Layout -->
<div class="contact-grid">
<!-- Left Column: Booking Details -->
<div class="form-stack">
<!-- Booking Details Card -->
<div class="card">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
<h2 class="text-heading-2 text-navy">Booking Details</h2>
<span class="badge badge-{{.Booking.StatusClass}}">
                                {{.Booking.Status}}
                            </span>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Booking ID</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">{{.Booking.ID}}</p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Property</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">{{.Booking.PropertyAddress}}</p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Tour Date</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-calendar"></use></svg>
                                    {{.Booking.TourDate}}
                                </p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Tour Time</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-clock"></use></svg>
                                    {{.Booking.TourTime}}
                                </p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Contact Name</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-user"></use></svg>
                                    {{.Booking.ContactName}}
                                </p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Contact Email</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-envelope"></use></svg>
                                    {{.Booking.ContactEmail}}
                                </p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Contact Phone</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-phone"></use></svg>
                                    {{.Booking.ContactPhone}}
                                </p>
</div>
<div>
<p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 4px;">Created</p>
<p style="font-size: 1rem; color: var(--navy-primary); font-weight: 600; margin: 0;">{{.Booking.CreatedAt}}</p>
</div>
</div>

                        {{if .Booking.Notes}}
                        <div style="margin-top: 24px; padding: 16px; background: var(--gray-50); border-radius: 8px;">
<h3 class="text-heading-3 text-navy mb-2">Additional Notes</h3>
<p style="color: var(--gray-700); margin: 0;">{{.Booking.Notes}}</p>
</div>
                        {{end}}
                    </div>
<!-- Property Preview Card -->
                    {{if .Property}}
                    <div class="card">
<h2 class="text-heading-2 text-navy mb-8">Property Information</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                            {{if .Property.ImageURL}}
                            <div style="grid-column: 1 / -1;">
<img alt="{{.Property.Address}}" src="{{.Property.ImageURL}}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 12px;"/>
</div>
                            {{end}}
                            <div style="grid-column: 1 / -1;">
<h3 class="text-heading-3 text-navy mb-2">{{.Property.Address}}</h3>
<p style="color: var(--gray-600); margin-bottom: 16px;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-map-pin"></use></svg>
                                    {{.Property.City}}, {{.Property.State}} {{.Property.Zip}}
                                </p>
<div style="display: flex; gap: 16px; margin-bottom: 16px;">
<span style="padding: 8px 16px; background: var(--gray-100); border-radius: 8px; font-size: 0.875rem; color: var(--gray-700);">{{.Property.Bedrooms}} bed</span>
<span style="padding: 8px 16px; background: var(--gray-100); border-radius: 8px; font-size: 0.875rem; color: var(--gray-700);">{{.Property.Bathrooms}} bath</span>
<span style="padding: 8px 16px; background: var(--gray-100); border-radius: 8px; font-size: 0.875rem; color: var(--gray-700);">{{.Property.SquareFeet}} sq ft</span>
</div>
<p style="font-size: 1.75rem; color: var(--gold-primary); font-weight: 700; margin-bottom: 16px;">${{.Property.Rent}}/month</p>
<a class="btn btn-secondary" href="/property/{{.Property.ID}}">View Full Details</a>
</div>
</div>
</div>
                    {{end}}
                </div>
<!-- Right Column: Actions -->
<div style="display: flex; flex-direction: column; gap: 24px;">
                    
                    {{if eq .Booking.Status "confirmed"}}
                    <!-- Manage Booking Card -->
<div style="background: var(--white); padding: 32px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">
<h3 class="text-heading-3 text-navy mb-6">Manage Booking</h3>
<div style="display: flex; flex-direction: column; gap: 12px;">
<button class="btn btn-primary btn-block" onclick="showRescheduleModal()" type="button">
<svg class="icon" height="20" width="20"><use href="#icon-calendar"></use></svg>
                                Reschedule Tour
                            </button>
<button class="btn btn-secondary btn-block" onclick="showCancelModal()" type="button">
<svg class="icon" height="20" width="20"><use href="#icon-x-circle"></use></svg>
                                Cancel Booking
                            </button>
</div>
</div>
                    {{end}}

                    <!-- Help Card -->
<div style="background: var(--gold-50); padding: 32px; border-radius: 16px; border: 2px solid var(--gold-200);">
<div style="text-align: center; margin-bottom: 16px;">
<svg height="48" style="color: var(--gold-primary);" width="48"><use href="#icon-info"></use></svg>
</div>
<h3 class="text-heading-3 text-navy text-center mb-4">Need Help?</h3>
<p style="color: var(--gray-700); text-align: center; margin-bottom: 16px;">Contact us for assistance with your booking</p>
<div style="text-align: center;">
<p style="font-weight: 600; color: var(--navy-primary); margin-bottom: 8px;">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-phone"></use></svg>
                                (281) 925-7222
                            </p>
<p style="font-weight: 600; color: var(--navy-primary);">
<svg height="16" style="display: inline-block; vertical-align: middle; margin-right: 4px;" width="16"><use href="#icon-envelope"></use></svg>
                                tours@propertyhub.com
                            </p>
</div>
</div>
</div>
</div>

            {{else}}
            <!-- No Booking Found -->
<div style="max-width: 600px; margin: 0 auto;">
<div style="background: var(--white); padding: 64px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); text-align: center;">
<svg height="80" style="color: var(--gray-400); margin-bottom: 24px;" width="80"><use href="#icon-x-circle"></use></svg>
<h2 class="text-heading-2 text-navy mb-4">Booking Not Found</h2>
<p style="color: var(--gray-600); margin-bottom: 32px;">We couldn't find a booking with the provided information.</p>
<a class="btn btn-primary" href="/properties">Browse Properties</a>
</div>
</div>
            {{end}}
        </div>
</section>
</main>
<!-- Reschedule Modal -->
<div class="modal" id="reschedule-modal">
<div class="modal-backdrop" onclick="closeRescheduleModal()"></div>
<div class="modal-wrapper">
<div class="modal-container">
<div class="modal-header">
<h3 class="modal-title">Reschedule Tour</h3>
<button class="modal-close" onclick="closeRescheduleModal()" type="button">
<svg class="modal-close-icon" height="24" width="24"><use href="#icon-x"></use></svg>
</button>
</div>
<form id="reschedule-form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
<div class="modal-content">
<div class="form-group">
<label class="form-label" for="new-date">New Tour Date</label>
<input class="form-input" id="new-date" name="new_date" required="" type="date"/>
</div>
<div class="form-group">
<label class="form-label" for="new-time">New Tour Time</label>
<select class="form-select" id="new-time" name="new_time" required="">
<option value="">Select a time</option>
<option value="09:00">9:00 AM</option>
<option value="10:00">10:00 AM</option>
<option value="11:00">11:00 AM</option>
<option value="13:00">1:00 PM</option>
<option value="14:00">2:00 PM</option>
<option value="15:00">3:00 PM</option>
<option value="16:00">4:00 PM</option>
</select>
</div>
<div class="form-group">
<label class="form-label" for="reschedule-reason">Reason (Optional)</label>
<textarea class="form-textarea" id="reschedule-reason" name="reason" rows="3"></textarea>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeRescheduleModal()" type="button">Cancel</button>
<button class="btn btn-primary" type="submit">Confirm Reschedule</button>
</div>
</form>
</div>
</div>
</div>
<!-- Cancel Modal -->
<div class="modal" id="cancel-modal">
<div class="modal-backdrop" onclick="closeCancelModal()"></div>
<div class="modal-wrapper">
<div class="modal-container">
<div class="modal-header">
<h3 class="modal-title">Cancel Booking</h3>
<button class="modal-close" onclick="closeCancelModal()" type="button">
<svg class="modal-close-icon" height="24" width="24"><use href="#icon-x"></use></svg>
</button>
</div>
<form id="cancel-form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
<div style="padding: 24px;">
<div class="alert alert-danger" style="margin-bottom: 24px;">
<h4 style="color: var(--red-700); font-weight: 600; margin-bottom: 8px;">Are you sure?</h4>
<p style="color: var(--red-600); font-size: 0.875rem; margin: 0;">This action cannot be undone. You will need to create a new booking if you change your mind.</p>
</div>
<div class="form-group">
<label class="form-label" for="cancel-reason">Cancellation Reason (Optional)</label>
<textarea class="form-textarea" id="cancel-reason" name="reason" rows="3"></textarea>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeCancelModal()" type="button">Keep Booking</button>
<button class="btn btn-primary btn-danger" type="submit">Cancel Booking</button>
</div>
</form>
</div>
</div>
</div>
<!-- Footer -->
<footer class="trec-footer">
<div class="trec-content">
<p class="trec-content-text">Landlords of Texas, LLC • License # 9008008 • (281) 925-7222</p>
<p class="trec-content-text">Terry Evans - Principal Broker #615707</p>
<p class="trec-content-text">
<a class="trec-link trec-content-link" href="https://content.harstatic.com/pdf/TREC_CPN.pdf" rel="noopener" target="_blank">TREC Consumer Protection Notice</a> • 
            <a class="trec-content-link" href="https://members.har.com/mhf/terms/dispBrokerInfo.cfm?sitetype=aws&amp;cid=625244" rel="noopener" target="_blank">Information About Brokerage Services</a>
</p>
<p class="text-center text-gray-600 trec-content-text">
<a class="trec-content-link" href="/terms">Terms of Service</a> • 
            <a class="trec-content-link" href="/privacy">Privacy Policy</a> • 
            <a class="trec-content-link" href="javascript:revokeCookieConsent()">Cookie Preferences</a> • 
            <a class="trec-content-link" href="/contact">Contact</a> • 
            <a class="trec-content-link" href="/admin">Admin Login</a>
</p>
<p class="text-center text-gray-600 trec-content-text">
<img alt="Equal Housing Opportunity" class="trec-content-image" src="/static/images/equal-housing-logo.png" style="height: 20px; vertical-align: middle; margin-right: 8px;"/>Equal Housing Opportunity • All information deemed reliable but not guaranteed.
        </p>
</div>
</footer>
<script>
function showRescheduleModal() {
    document.getElementById('reschedule-modal').style.display = 'block';
}
function closeRescheduleModal() {
    document.getElementById('reschedule-modal').style.display = 'none';
}
function showCancelModal() {
    document.getElementById('cancel-modal').style.display = 'block';
}
function closeCancelModal() {
    document.getElementById('cancel-modal').style.display = 'none';
}

// Form submissions
document.getElementById('reschedule-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = {
        booking_id: '{{.Booking.ID}}',
        new_date: document.getElementById('new-date').value,
        new_time: document.getElementById('new-time').value,
        reason: document.getElementById('reschedule-reason').value
    };
    
    try {
        const response = await fetch('/api/booking/reschedule', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            alert('Your tour has been rescheduled successfully!');
            location.reload();
        } else {
            alert('Failed to reschedule. Please try again or contact us.');
        }
    } catch (error) {
        console.error('Reschedule error:', error);
        alert('An error occurred. Please contact us at (281) 925-7222.');
    }
});

document.getElementById('cancel-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = {
        booking_id: '{{.Booking.ID}}',
        reason: document.getElementById('cancel-reason').value
    };
    
    try {
        const response = await fetch('/api/booking/cancel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            alert('Your booking has been cancelled.');
            window.location.href = '/properties';
        } else {
            alert('Failed to cancel booking. Please try again or contact us.');
        }
    } catch (error) {
        console.error('Cancel error:', error);
        alert('An error occurred. Please contact us at (281) 925-7222.');
    }
});
</script>
</body>
</html>
