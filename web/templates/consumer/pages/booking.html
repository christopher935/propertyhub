<!DOCTYPE html>
<html lang="en">
{{template "_head.html" .}}
<body class="scout-consumer-layout page-booking">
{{template "_svg_sprite.html"}}


    <!-- Header -->
    <header class="header-simple">
        <div class="container-wide flex items-center justify-between py-4">
            <a href="/" class="logo-link flex items-center gap-2">
                <svg class="logo-icon" height="32" width="32"><use href="#icon-home"></use></svg>
                <span class="logo-text">Landlords of Texas</span>
            </a>
            <a href="/properties" class="back-link">← Back to Properties</a>
        </div>
    </header>

    <!-- Booking Wizard -->
    <main class="booking-wizard">
        <div class="container-narrow py-8">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">
                        <div class="step-title">Select Property</div>
                    </div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">
                        <div class="step-title">Date & Time</div>
                    </div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">
                        <div class="step-title">Contact Info</div>
                    </div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">
                        <div class="step-title">Confirmation</div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Select Property -->
            <div class="wizard-step active" id="step-1">
                <div class="step-content">
                    <h1 class="text-center mb-2">Select Property</h1>
                    <p class="text-center text-muted mb-6">Choose the property you'd like to tour</p>

                    <div class="property-selection">
                        {{range .Properties}}
                        <div class="property-card selectable" data-property-id="{{.ID}}" data-property-address="{{.Address}}" data-property-price="{{.MonthlyRent}}">
                            <div class="property-image">
                                <span class="badge badge-success" style="position: absolute; top: 8px; left: 8px; z-index: 10;">FOR RENT</span>
                                {{if .FeaturedImage}}
                                <img alt="{{.Address}}" loading="lazy" src="{{.FeaturedImage}}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"/>
                                {{else if .Images}}
                                <img alt="{{.Address}}" loading="lazy" src="{{index .Images 0}}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"/>
                                {{end}}
                                <div class="property-placeholder" style="{{if or .FeaturedImage .Images}}display: none;{{else}}display: flex;{{end}}">
                                    <svg height="80" width="80" style="color: var(--gray-400);"><use href="#icon-home"></use></svg>
                                </div>
                            </div>
                            <div class="property-info">
                                <h3 class="property-address">{{.Address}}</h3>
                                <p class="property-price">${{.MonthlyRent | formatNumber}}/month</p>
                                <p class="property-specs">{{.Bedrooms}} bed • {{.Bathrooms}} bath • {{.SquareFeet | formatNumber}} sq ft</p>
                            </div>
                        </div>
                        {{end}}
                    </div>

                    <div class="step-actions">
                        <button type="button" class="btn btn-primary" id="step1-next" disabled>Next Step</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Date & Time -->
            <div class="wizard-step" id="step-2">
                <div class="step-content">
                    <h1 class="text-center mb-6">Select Date & Time</h1>

                    <div class="datetime-selector">
                        <!-- Calendar -->
                        <div class="calendar-section">
                            <div class="section-label section-label--minimal">
                              <span class="section-label-text">Select Date</span>
                            </div>
                            <div class="calendar">
                                <div class="calendar-header">
                                    <button type="button" class="calendar-nav" id="prev-month">‹</button>
                                    <div class="calendar-month" id="current-month">November 2025</div>
                                    <button type="button" class="calendar-nav" id="next-month">›</button>
                                </div>
                                <div class="calendar-weekdays">
                                    <div class="weekday">Sun</div>
                                    <div class="weekday">Mon</div>
                                    <div class="weekday">Tue</div>
                                    <div class="weekday">Wed</div>
                                    <div class="weekday">Thu</div>
                                    <div class="weekday">Fri</div>
                                    <div class="weekday">Sat</div>
                                </div>
                                <div class="calendar-dates" id="calendar-dates">
                                    <!-- Dates will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Time Slots -->
                        <div class="time-section">
                            <div class="section-label section-label--minimal">
                              <span class="section-label-text">Select Time</span>
                            </div>
                            <div class="time-slots">
                                <button type="button" class="time-slot" data-time="10:00 AM">10:00 AM</button>
                                <button type="button" class="time-slot" data-time="11:00 AM">11:00 AM</button>
                                <button type="button" class="time-slot" data-time="12:00 PM">12:00 PM</button>
                                <button type="button" class="time-slot" data-time="1:00 PM">1:00 PM</button>
                                <button type="button" class="time-slot" data-time="2:00 PM">2:00 PM</button>
                                <button type="button" class="time-slot" data-time="3:00 PM">3:00 PM</button>
                                <button type="button" class="time-slot" data-time="4:00 PM">4:00 PM</button>
                                <button type="button" class="time-slot" data-time="5:00 PM">5:00 PM</button>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button type="button" class="btn btn-secondary" id="step2-back">Back</button>
                        <button type="button" class="btn btn-primary" id="step2-next" disabled>Next Step</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Contact Information -->
            <div class="wizard-step" id="step-3">
                <div class="step-content">
                    <h1 class="text-center mb-2">Contact Information</h1>
                    <p class="text-center text-muted mb-6">Please provide your details for the tour confirmation</p>

                    <form class="booking-form" id="contact-form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                        <div class="form-group">
                            <label for="full-name">Full Name</label>
                            <input type="text" id="full-name" name="full_name" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label for="special-requests">Special Requests (Optional)</label>
                            <textarea id="special-requests" name="special_requests" class="form-textarea" rows="4"></textarea>
                        </div>
                    </form>

                    <div class="step-actions">
                        <button type="button" class="btn btn-secondary" id="step3-back">Back</button>
                        <button type="button" class="btn btn-primary" id="step3-next">Schedule Tour</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="wizard-step" id="step-4">
                <div class="step-content">
                    <div class="confirmation-success">
                        <div class="success-icon">✓</div>
                        <h1 class="text-center mb-2">Tour Confirmed!</h1>
                        <p class="text-center text-muted mb-6">Your property tour has been successfully scheduled. You'll receive a confirmation email shortly.</p>

                        <div class="confirmation-details">
                            <div class="detail-row">
                                <span class="detail-label">Property:</span>
                                <span class="detail-value" id="confirm-property">—</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Date:</span>
                                <span class="detail-value" id="confirm-date">—</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Time:</span>
                                <span class="detail-value" id="confirm-time">—</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Contact:</span>
                                <span class="detail-value" id="confirm-contact">—</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Confirmation ID:</span>
                                <span class="detail-value" id="confirm-id">#TB-2025-001</span>
                            </div>
                        </div>

                        <div class="step-actions">
                            <a href="/properties" class="btn btn-primary">Back to Properties</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

{{template "_footer.html"}}

    <script>
        // Booking state
        const bookingState = {
            currentStep: 1,
            propertyId: null,
            propertyAddress: null,
            propertyPrice: null,
            selectedDate: null,
            selectedTime: null,
            contactInfo: {}
        };

        // Step navigation
        function goToStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.classList.remove('active');
            });

            // Show target step
            document.getElementById(`step-${stepNumber}`).classList.add('active');

            // Update step indicator
            document.querySelectorAll('.step-indicator .step').forEach((step, index) => {
                if (index + 1 < stepNumber) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index + 1 === stepNumber) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            bookingState.currentStep = stepNumber;
            window.scrollTo(0, 0);
        }

        // Step 1: Property Selection
        document.querySelectorAll('.property-card.selectable').forEach(card => {
            card.addEventListener('click', function() {
                // Remove selection from all cards
                document.querySelectorAll('.property-card.selectable').forEach(c => {
                    c.classList.remove('selected');
                });

                // Select this card
                this.classList.add('selected');

                // Store selection
                bookingState.propertyId = this.dataset.propertyId;
                bookingState.propertyAddress = this.dataset.propertyAddress;
                bookingState.propertyPrice = this.dataset.propertyPrice;

                // Enable next button
                document.getElementById('step1-next').disabled = false;
            });
        });

        document.getElementById('step1-next').addEventListener('click', () => {
            if (bookingState.propertyId) {
                goToStep(2);
            }
        });

        // Step 2: Calendar
        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const calendarDates = document.getElementById('calendar-dates');
            calendarDates.innerHTML = '';

            // Add empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-date empty';
                calendarDates.appendChild(emptyCell);
            }

            // Add days of month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateCell = document.createElement('button');
                dateCell.type = 'button';
                dateCell.className = 'calendar-date';
                dateCell.textContent = day;
                
                const cellDate = new Date(year, month, day);
                
                // Disable past dates
                if (cellDate < today.setHours(0, 0, 0, 0)) {
                    dateCell.disabled = true;
                    dateCell.classList.add('disabled');
                } else {
                    dateCell.addEventListener('click', function() {
                        document.querySelectorAll('.calendar-date').forEach(d => d.classList.remove('selected'));
                        this.classList.add('selected');
                        bookingState.selectedDate = `${month + 1}/${day}/${year}`;
                        checkStep2Complete();
                    });
                }

                calendarDates.appendChild(dateCell);
            }
        }

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function updateCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            generateCalendar(currentYear, currentMonth);
        }

        document.getElementById('prev-month').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendar();
        });

        // Initialize calendar
        updateCalendar();

        // Time slot selection
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.addEventListener('click', function() {
                document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                bookingState.selectedTime = this.dataset.time;
                checkStep2Complete();
            });
        });

        function checkStep2Complete() {
            const nextBtn = document.getElementById('step2-next');
            nextBtn.disabled = !(bookingState.selectedDate && bookingState.selectedTime);
        }

        document.getElementById('step2-back').addEventListener('click', () => goToStep(1));
        document.getElementById('step2-next').addEventListener('click', () => {
            if (bookingState.selectedDate && bookingState.selectedTime) {
                goToStep(3);
            }
        });

        // Step 3: Contact Form
        document.getElementById('step3-back').addEventListener('click', () => goToStep(2));
        document.getElementById('step3-next').addEventListener('click', () => {
            const form = document.getElementById('contact-form');
            if (form.checkValidity()) {
                bookingState.contactInfo = {
                    fullName: document.getElementById('full-name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    specialRequests: document.getElementById('special-requests').value
                };

                // Update confirmation details
                document.getElementById('confirm-property').textContent = bookingState.propertyAddress;
                document.getElementById('confirm-date').textContent = bookingState.selectedDate;
                document.getElementById('confirm-time').textContent = bookingState.selectedTime;
                document.getElementById('confirm-contact').textContent = bookingState.contactInfo.email;

                // Generate confirmation ID
                const confirmId = `#TB-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`;
                document.getElementById('confirm-id').textContent = confirmId;

                goToStep(4);
            } else {
                form.reportValidity();
            }
        });
    </script>

{{template "_scripts.html" .}}
</body>
</html>

