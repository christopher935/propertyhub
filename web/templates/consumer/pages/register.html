<!DOCTYPE html>

<html lang="en">
{{template "_head.html" .}}
<body class="scout-consumer-layout page-register">
{{template "_svg_sprite.html"}}
<!-- Header -->
{{template "_nav.html" .}}
<!-- Registration Wizard -->
<main class="booking-wizard">
<div class="container-narrow pt-8 pb-4">
<!-- Step Indicator -->
<div class="step-indicator">
<div class="step active" data-step="1">
<div class="step-circle">1</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Personal Info</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" data-step="2">
<div class="step-circle">2</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Contact Details</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" data-step="3">
<div class="step-circle">3</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Account Security</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" data-step="4">
<div class="step-circle">4</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Confirmation</div>
</div>
</div>
</div>
<!-- Step 1: Personal Information -->
<div class="wizard-step active" id="step-1">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Create Your Account</h1>
<p class="text-body text-gray-600 text-center mb-6">Let's start with your basic information</p>
<form id="registration-form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
<div class="form-group">
<label class="form-label" for="first-name">First Name</label>
<input autocomplete="given-name" class="form-input" id="first-name" name="first_name" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label" for="last-name">Last Name</label>
<input autocomplete="family-name" class="form-input" id="last-name" name="last_name" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label" for="email">Email Address</label>
<input autocomplete="email" class="form-input" id="email" name="email" required="" type="email"/>
<div class="form-help-text">We'll use this for your login and notifications</div>
</div>
<div class="form-actions">
<button class="btn btn-primary btn-block" onclick="nextStep(2)" type="button">Continue</button>
</div>
</form>
</div>
</div>
<!-- Step 2: Contact Details -->
<div class="wizard-step" id="step-2">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Contact Information</h1>
<p class="text-body text-gray-600 text-center mb-6">How can we reach you?</p>
<div class="form-group">
<label class="form-label" for="phone">Phone Number</label>
<input autocomplete="tel" class="form-input" id="phone" name="phone" placeholder="(281) 925-7222" required="" type="tel"/>
<div class="form-help-text">For tour confirmations and important updates</div>
</div>
<div class="form-group">
<label class="form-label">Communication Preferences</label>
<div class="checkbox-group">
<label class="checkbox-label">
<input class="form-checkbox checkbox-label-input" name="sms_notifications" type="checkbox"/>
<span class="checkbox-label-label">SMS notifications for tour reminders</span>
</label>
<label class="checkbox-label">
<input checked="" class="form-checkbox checkbox-label-input" name="email_notifications" type="checkbox"/>
<span class="checkbox-label-label">Email updates about new properties</span>
</label>
<label class="checkbox-label">
<input class="form-checkbox checkbox-label-input" name="marketing_opt_in" type="checkbox"/>
<span class="checkbox-label-label">Receive exclusive offers and promotions</span>
</label>
</div>
</div>
<div class="form-actions">
<button class="btn btn-secondary" onclick="prevStep(1)" type="button">Back</button>
<button class="btn btn-primary" onclick="nextStep(3)" type="button">Continue</button>
</div>
</div>
</div>
<!-- Step 3: Account Security -->
<div class="wizard-step" id="step-3">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Secure Your Account</h1>
<p class="text-body text-gray-600 text-center mb-6">Create a strong password</p>
<div class="form-group">
<label class="form-label" for="password">Password</label>
<input autocomplete="new-password" class="form-input" id="password" minlength="8" name="password" required="" type="password"/>
<div class="form-help-text">At least 8 characters with letters and numbers</div>
</div>
<div class="form-group">
<label class="form-label" for="password-confirm">Confirm Password</label>
<input autocomplete="new-password" class="form-input" id="password-confirm" name="password_confirm" required="" type="password"/>
</div>
<div class="form-group">
<label class="checkbox-label">
<input class="form-checkbox checkbox-label-input" name="terms_consent" required="" type="checkbox"/>
<span class="checkbox-label-label">I agree to the <a class="checkbox-label-link" href="/terms" target="_blank">Terms of Service</a> and <a class="checkbox-label-link" href="/privacy" target="_blank">Privacy Policy</a></span>
</label>
</div>
<div class="form-actions">
<button class="btn btn-secondary" onclick="prevStep(2)" type="button">Back</button>
<button class="btn btn-primary" onclick="submitRegistration()" type="button">Create Account</button>
</div>
</div>
</div>
<!-- Step 4: Success Confirmation -->
<div class="wizard-step" id="step-4">
<div class="step-content text-center">
<div class="success-icon mb-4">
<svg class="text-success mx-auto" height="64" width="64"><use href="#icon-check"></use></svg>
</div>
<h1 class="text-heading-1 font-serif text-navy mb-2">Welcome to Landlords of Texas!</h1>
<p class="text-body text-gray-600 mb-6">Your account has been created successfully. You can now schedule tours and manage your bookings.</p>
<div class="form-actions">
<a class="btn btn-primary" href="/properties">Browse Properties</a>
<a class="btn btn-secondary" href="/book-showing">Schedule a Tour</a>
</div>
</div>
</div>
</div>
</main>
<!-- TREC Footer -->
{{template "_footer.html"}}
<script>
// Registration wizard state
let currentStep = 1;
const formData = {};

// Step navigation
function nextStep(step) {
    // Validate current step
    if (!validateStep(currentStep)) {
        return;
    }
    
    // Save current step data
    saveStepData(currentStep);
    
    // Hide current step
    document.querySelector(`#step-${currentStep}`).classList.remove('active');
    document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
    document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
    
    // Show next step
    currentStep = step;
    document.querySelector(`#step-${step}`).classList.add('active');
    document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function prevStep(step) {
    // Hide current step
    document.querySelector(`#step-${currentStep}`).classList.remove('active');
    document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
    
    // Show previous step
    currentStep = step;
    document.querySelector(`#step-${step}`).classList.add('active');
    document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
    document.querySelector(`.step[data-step="${step}"]`).classList.remove('completed');
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function validateStep(step) {
    const stepElement = document.querySelector(`#step-${step}`);
    const inputs = stepElement.querySelectorAll('input[required]');
    
    for (let input of inputs) {
        if (!input.value.trim()) {
            input.focus();
            alert('Please fill in all required fields');
            return false;
        }
        
        if (input.type === 'email' && !isValidEmail(input.value)) {
            input.focus();
            alert('Please enter a valid email address');
            return false;
        }
        
        if (input.id === 'password-confirm') {
            const password = document.getElementById('password').value;
            if (input.value !== password) {
                input.focus();
                alert('Passwords do not match');
                return false;
            }
        }
    }
    
    return true;
}

function saveStepData(step) {
    const stepElement = document.querySelector(`#step-${step}`);
    const inputs = stepElement.querySelectorAll('input');
    
    inputs.forEach(input => {
        if (input.type === 'checkbox') {
            formData[input.name] = input.checked;
        } else {
            formData[input.name] = input.value;
        }
    });
}

function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

async function submitRegistration() {
    // Validate final step
    if (!validateStep(3)) {
        return;
    }
    
    // Save final step data
    saveStepData(3);
    
    try {
        // Execute reCAPTCHA v3
        const token = await grecaptcha.execute('YOUR_RECAPTCHA_SITE_KEY', { action: 'register' });
        formData.recaptcha_token = token;
        
        // Submit to backend
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            // Show success step
            nextStep(4);
        } else {
            const error = await response.json();
            alert(error.message || 'Registration failed. Please try again.');
        }
    } catch (error) {
        console.error('Registration error:', error);
        alert('An error occurred. Please try again or contact us for assistance.');
    }
}
</script>
</body>
</html>
