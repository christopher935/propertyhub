<!DOCTYPE html>

<html lang="en">
{{template "_head.html" .}}
<body class="scout-consumer-layout page-book-showing">
{{template "_svg_sprite.html"}}
<style>
        .icon-gold { color: var(--gold-primary); }
        .icon-gold svg { color: var(--gold-primary); }
    </style>
<!-- Header -->
{{template "_nav.html" .}}
<!-- Booking Wizard -->
<main class="booking-wizard" x-data="bookingForm()">
<div class="container-narrow pt-8 pb-4">
<!-- Error Display -->
<div x-show="error" x-transition class="alert alert-error mb-4" style="display: none;">
<svg height="20" width="20"><use href="#icon-warning"></use></svg>
<span x-text="error"></span>
</div>

<!-- Step Indicator -->
<div class="step-indicator">
<div class="step" :class="{ 'active': step === 1, 'completed': step > 1 }" data-step="1">
<div class="step-circle">1</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Pre-Qualification</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" :class="{ 'active': step === 2, 'completed': step > 2 }" data-step="2">
<div class="step-circle">2</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Date &amp; Time</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" :class="{ 'active': step === 3, 'completed': step > 3 }" data-step="3">
<div class="step-circle">3</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Contact Info</div>
</div>
</div>
<div class="step-line"></div>
<div class="step" :class="{ 'active': step === 4, 'completed': step > 4 }" data-step="4">
<div class="step-circle">4</div>
<div class="step-label">
<div class="text-body-sm font-semibold">Confirmation</div>
</div>
</div>
</div>
<!-- Step 1: Pre-Qualification -->
<div class="wizard-step" :class="{ 'active': step === 1 }" id="step-1" x-show="step === 1">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Rental Requirements</h1>
<p class="text-body text-gray-600 text-center mb-6">To ensure a smooth application process, please confirm you meet these requirements</p>
<div class="card p-6 max-w-3xl mx-auto">
<div class="text-center mb-6 pb-4 border-bottom">
<p class="text-body text-gray-700 mb-2">
<strong>Click each box below</strong> to confirm you meet all requirements
                            </p>
<p class="text-body-sm text-gray-600">
                                All four requirements must be checked to continue
                            </p>
</div>
<div class="flex flex-col gap-4 mb-5">
<div class="requirement-item" data-requirement="income">
<input class="requirement-checkbox" id="req-income" type="checkbox" x-model="requirementsChecked.income"/>
<div class="requirement-checkmark">
<svg class="icon-gold" height="20" width="20"><use href="#icon-check"></use></svg>
</div>
<div class="text-4xl icon-gold"><svg class="icon-gold" height="48" width="48"><use href="#icon-currency-dollar"></use></svg></div>
<div class="flex-1">
<strong class="block text-navy text-lg mb-1">Income Requirement</strong>
<p class="text-gray-600 text-sm m-0">Monthly household income is at least 3x the rent</p>
</div>
</div>
<div class="requirement-item" data-requirement="felony">
<input class="requirement-checkbox" id="req-felony" type="checkbox" x-model="requirementsChecked.felony"/>
<div class="requirement-checkmark">
<svg class="icon-gold" height="20" width="20"><use href="#icon-check"></use></svg>
</div>
<div class="text-4xl icon-gold"><svg class="icon-gold" height="48" width="48"><use href="#icon-scale"></use></svg></div>
<div class="flex-1">
<strong class="block text-navy text-lg mb-1">Criminal Background</strong>
<p class="text-gray-600 text-sm m-0">No felony convictions</p>
</div>
</div>
<div class="requirement-item" data-requirement="eviction">
<input class="requirement-checkbox" id="req-eviction" type="checkbox" x-model="requirementsChecked.eviction"/>
<div class="requirement-checkmark">
<svg class="icon-gold" height="20" width="20"><use href="#icon-check"></use></svg>
</div>
<div class="text-4xl icon-gold"><svg class="icon-gold" height="48" width="48"><use href="#icon-home"></use></svg></div>
<div class="flex-1">
<strong class="block text-navy text-lg mb-1">Rental History</strong>
<p class="text-gray-600 text-sm m-0">No evictions or broken leases in the past 7 years</p>
</div>
</div>
<div class="requirement-item" data-requirement="credit">
<input class="requirement-checkbox" id="req-credit" type="checkbox" x-model="requirementsChecked.credit"/>
<div class="requirement-checkmark">
<svg class="icon-gold" height="20" width="20"><use href="#icon-check"></use></svg>
</div>
<div class="text-4xl icon-gold"><svg class="icon-gold" height="48" width="48"><use href="#icon-chart-bar"></use></svg></div>
<div class="flex-1">
<strong class="block text-navy text-lg mb-1">Credit Score</strong>
<p class="text-gray-600 text-sm m-0">Credit score of 550 or higher</p>
</div>
</div>
</div>
<div class="bg-gray-50 border-left-gold p-4 rounded">
<p class="text-body-sm text-gray-600 m-0">
<svg class="inline-icon-sm" height="16" width="16"><use href="#icon-information-circle"></use></svg> <strong>Note:</strong> Meeting these requirements does not guarantee approval. Final approval is subject to verification and landlord discretion.
                            </p>
</div>
</div>
<div class="step-actions">
<button class="btn btn-primary" :disabled="!canProceedToStep2" id="step1-next" type="button" @click="nextStep()">Next Step</button>
</div>
</div>
</div>
<!-- Step 2: Date & Time -->
<div class="wizard-step" :class="{ 'active': step === 2 }" id="step-2" x-show="step === 2">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-6">Select Date &amp; Time</h1>
<div class="datetime-selector">
<!-- Calendar -->
<div class="calendar-section">
<div class="section-label section-label--minimal">
  <span class="section-label-text">Select Date</span>
</div>
<div class="calendar">
<div class="calendar-header">
<button class="calendar-nav-btn" id="prev-month" type="button">‹</button>
<div class="calendar-month" id="current-month">November 2025</div>
<button class="calendar-nav-btn" id="next-month" type="button">›</button>
</div>
<div class="calendar-weekdays">
<div class="weekday">Sun</div>
<div class="weekday">Mon</div>
<div class="weekday">Tue</div>
<div class="weekday">Wed</div>
<div class="weekday">Thu</div>
<div class="weekday">Fri</div>
<div class="weekday">Sat</div>
</div>
<div class="calendar-dates" id="calendar-dates">
<!-- Dates will be populated by JavaScript -->
</div>
</div>
<div class="calendar-notes">
<p>• Tours available Monday - Saturday</p>
<p>• Sundays are not available for tours</p>
</div>
</div>
<!-- Time Slots -->
<div class="time-section">
<div class="section-label section-label--minimal">
  <span class="section-label-text">Select Time</span>
</div>
<div class="time-slots">
<button class="time-slot" data-time="10:00 AM" type="button">
<span class="time-slot-time">10:00 AM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="11:00 AM" type="button">
<span class="time-slot-time">11:00 AM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="12:00 PM" type="button">
<span class="time-slot-time">12:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="1:00 PM" type="button">
<span class="time-slot-time">1:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="2:00 PM" type="button">
<span class="time-slot-time">2:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="3:00 PM" type="button">
<span class="time-slot-time">3:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="4:00 PM" type="button">
<span class="time-slot-time">4:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
<button class="time-slot" data-time="5:00 PM" type="button">
<span class="time-slot-time">5:00 PM</span>
<span class="time-slot-status">Available</span>
</button>
</div>
<p class="time-note">Tours typically last 15-30 minutes</p>
</div>
</div>
<div class="step-actions">
<button class="btn btn-secondary" id="step2-back" type="button" @click="prevStep()">Back</button>
<button class="btn btn-primary" :disabled="!canProceedToStep3" id="step2-next" type="button" @click="nextStep()" x-bind:class="{ 'loading': loading }">Next Step</button>
</div>
</div>
</div>
<!-- Step 3: Contact Information -->
<div class="wizard-step" :class="{ 'active': step === 3 }" id="step-3" x-show="step === 3">
<div class="step-content">
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Contact Information</h1>
<p class="text-body text-gray-600 text-center mb-6">Please provide your details for the tour confirmation</p>
<form class="booking-form" id="contact-form">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
<div class="form-group">
<label class="form-label" for="full-name">First Name</label>
<input class="form-input" id="first-name" name="first_name" required="" type="text" x-model="form.firstName"/>
</div>
<div class="form-group">
<label class="form-label" for="last-name">Last Name</label>
<input class="form-input" id="last-name" name="last_name" required="" type="text" x-model="form.lastName"/>
</div>
<div class="form-group">
<label class="form-label" for="email">Email</label>
<input class="form-input" id="email" name="email" required="" type="email" x-model="form.email"/>
<span x-show="errors.email" class="text-error text-sm" x-text="errors.email" style="display: none;"></span>
</div>
<div class="form-group">
<label class="form-label" for="phone">Phone Number</label>
<input class="form-input" id="phone" name="phone" required="" type="tel" x-model="form.phone"/>
<span x-show="errors.phone" class="text-error text-sm" x-text="errors.phone" style="display: none;"></span>
</div>
<div class="form-group">
<label class="form-label" for="special-requests">Special Requests (Optional)</label>
<textarea class="form-textarea" id="special-requests" name="special_requests" rows="4" x-model="form.notes"></textarea>
</div>
<div class="communication-notice">
<div class="notice-icon">
<svg height="24" width="24"><use href="#icon-envelope"></use></svg>
</div>
<div>
<p class="notice-title">Communication Notice</p>
<p class="notice-text">You will receive text and email updates about your tour confirmation, reminders, and any schedule changes.</p>
</div>
</div>
<div class="form-group">
<label class="checkbox-label">
<input class="checkbox-label-input" id="marketing-opt-in" type="checkbox" x-model="form.marketingOptIn"/>
<span class="checkbox-label-label">Also send me emails about new available properties</span>
</label>
</div>
<div class="form-group">
<label class="checkbox-label">
<input class="checkbox-label-input" id="terms-consent" required="" type="checkbox" x-model="form.consentGiven"/>
<span class="checkbox-label-label">I agree to the <a class="checkbox-label-link" href="/terms-of-service" target="_blank">Terms of Service</a> and <a class="checkbox-label-link" href="/privacy-policy" target="_blank">Privacy Policy</a>. I consent to be contacted about this tour. *</span>
</label>
<span x-show="errors.consentGiven" class="text-error text-sm" x-text="errors.consentGiven" style="display: none;"></span>
</div>
</form>
<div class="step-actions">
<button class="btn btn-secondary" id="step3-back" type="button" @click="prevStep()">Back</button>
<button class="btn btn-primary" id="step3-submit" type="button" @click="submitBooking()" :disabled="loading" x-bind:class="{ 'loading': loading }">
<span x-show="!loading">Confirm Tour</span>
<span x-show="loading" style="display: none;">Submitting...</span>
</button>
</div>
</div>
</div>
<!-- Step 4: Confirmation -->
<div class="wizard-step" :class="{ 'active': step === 4 }" id="step-4" x-show="step === 4">
<div class="step-content">
<div class="confirmation-success">
<div class="success-icon">✓</div>
<h1 class="text-heading-1 font-serif text-navy text-center mb-2">Tour Confirmed!</h1>
<p class="text-body text-gray-600 text-center mb-6">Your property tour has been successfully scheduled. You'll receive a confirmation email shortly.</p>
<div class="confirmation-details">
<div class="detail-row">
<span class="detail-label">Property:</span>
<span class="detail-value" id="confirm-property">—</span>
</div>
<div class="detail-row">
<span class="detail-label">Date:</span>
<span class="detail-value" id="confirm-date">—</span>
</div>
<div class="detail-row">
<span class="detail-label">Time:</span>
<span class="detail-value" id="confirm-time">—</span>
</div>
<div class="detail-row">
<span class="detail-label">Contact:</span>
<span class="detail-value" id="confirm-contact">—</span>
</div>
<div class="detail-row">
<span class="detail-label">Confirmation ID:</span>
<span class="detail-value" id="confirm-id">#TB-2025-001</span>
</div>
</div>
<div class="step-actions">
<a class="btn btn-primary" href="/properties">Back to Properties</a>
</div>
</div>
</div>
</div>
</div>
</main>
<script>
        // Booking state
        const bookingState = {
            currentStep: 1,
            propertyId: null,
            propertyAddress: null,
            propertyPrice: null,
            selectedDate: null,
            selectedTime: null,
            contactInfo: {}
        };

        // Step navigation handled by Alpine.js

        // Step 1: Pre-Qualification
        const requirementCheckboxes = document.querySelectorAll('.requirement-checkbox');
        const requirementItems = document.querySelectorAll('.requirement-item');
        
        requirementItems.forEach(item => {
            item.addEventListener('click', function(e) {
                if (e.target.classList.contains('requirement-checkbox')) return;
                
                const checkbox = this.querySelector('.requirement-checkbox');
                checkbox.checked = !checkbox.checked;
                
                if (checkbox.checked) {
                    this.classList.add('checked');
                } else {
                    this.classList.remove('checked');
                }
                
                const allChecked = Array.from(requirementCheckboxes).every(cb => cb.checked);
                document.getElementById('step1-next').disabled = !allChecked;
            });
        });
        
        requirementCheckboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                const item = this.closest('.requirement-item');
                if (this.checked) {
                    item.classList.add('checked');
                } else {
                    item.classList.remove('checked');
                }
                
                const allChecked = Array.from(requirementCheckboxes).every(cb => cb.checked);
                document.getElementById('step1-next').disabled = !allChecked;
            });
        });

        // Step 1 navigation handled by Alpine.js

        // Step 2: Calendar
        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const calendarDates = document.getElementById('calendar-dates');
            calendarDates.innerHTML = '';

            // Add empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-date empty';
                calendarDates.appendChild(emptyCell);
            }

            // Add days of month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateCell = document.createElement('button');
                dateCell.type = 'button';
                dateCell.className = 'calendar-date';
                dateCell.textContent = day;
                
                const cellDate = new Date(year, month, day);
                
                // Disable past dates
                if (cellDate < today.setHours(0, 0, 0, 0)) {
                    dateCell.disabled = true;
                    dateCell.classList.add('disabled');
                } else {
                    dateCell.addEventListener('click', function() {
                        document.querySelectorAll('.calendar-date').forEach(d => d.classList.remove('selected'));
                        this.classList.add('selected');
                        const alpineComponent = Alpine.$data(document.querySelector('[x-data]'));
                        if (alpineComponent) {
                            alpineComponent.form.showingDate = `${month + 1}/${day}/${year}`;
                        }
                    });
                }

                calendarDates.appendChild(dateCell);
            }
        }

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function updateCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            generateCalendar(currentYear, currentMonth);
        }

        document.getElementById('prev-month').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendar();
        });

        // Initialize calendar
        updateCalendar();

        // Time slot selection
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.addEventListener('click', function() {
                document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                const alpineComponent = Alpine.$data(document.querySelector('[x-data]'));
                if (alpineComponent) {
                    alpineComponent.form.showingTime = this.dataset.time;
                }
            });
        });

        function checkStep2Complete() {
            // No longer needed - Alpine.js handles this
        }

        // Step navigation handled by Alpine.js

        // Step 3: Contact Form - handled by Alpine.js
        
        // Submit button handled by Alpine.js submitBooking() method

        // All form interactions now handled by Alpine.js
    </script>
<!-- Footer -->
{{template "_footer.html"}}
</body>
</html>
