#!/bin/bash

echo "ğŸ” Running pre-commit checks..."

ROUTE_FILES=$(git diff --cached --name-only | grep -E "routes.*\.go$")

if [ -n "$ROUTE_FILES" ]; then
    echo "ğŸ“‹ Route files modified: $ROUTE_FILES"
    echo "ğŸ”¨ Building and validating routes..."
    
    if ! go build -o /tmp/propertyhub-check ./cmd/server 2>&1; then
        echo "âŒ Build failed! Fix compilation errors before committing."
        exit 1
    fi
    
    if ! /tmp/propertyhub-check --dry-run 2>&1; then
        echo "âŒ Route validation failed! Fix duplicate routes before committing."
        rm -f /tmp/propertyhub-check
        exit 1
    fi
    
    rm -f /tmp/propertyhub-check
    echo "âœ… Route validation passed"
fi

echo "âœ… Pre-commit checks passed"
exit 0
